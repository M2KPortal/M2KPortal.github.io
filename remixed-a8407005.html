<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mount 2K Housing Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.4;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #061d28, #0f3a4a);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            margin-bottom: 8px;
            font-size: 2.2em;
        }

        /* Tab System */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 12px 24px;
            background: #f5f5f5;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
            color: #061d28;
        }

        .tab-button.active {
            background: #061d28;
            color: #d4af37;
        }

        .tab-button:hover {
            background: #0f3a4a;
            color: #d4af37;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        /* Dashboard Statistics */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #061d28, #0f3a4a);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #d4af37;
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 10px;
            color: #d4af37;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input, .form-group select, .form-group textarea {
            padding: 10px;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            height: 80px;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
            font-size: 14px;
        }

        .btn-primary { background: #061d28; color: #d4af37; border: 2px solid #d4af37; }
        .btn-primary:hover { background: #d4af37; color: #061d28; }
        .btn-success { background: #2e7d32; color: white; }
        .btn-success:hover { background: #1b5e20; }
        .btn-danger { background: #8b4513; color: white; }
        .btn-danger:hover { background: #654321; }
        .btn-warning { background: #d4af37; color: #061d28; }
        .btn-warning:hover { background: #b8941f; }

        /* Tables */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
            font-size: 14px;
        }

        .table th {
            background: #061d28;
            color: #d4af37;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        /* Search */
        .search-bar {
            width: 100%;
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        /* Assignment System */
        .assignment-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .group-details, .available-rooms {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .room-card {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #061d28;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .room-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
            border-left-color: #d4af37;
        }

        .room-card.selected {
            background: #f9f7f0;
            border-left-color: #d4af37;
            border: 2px solid #d4af37;
            border-left: 4px solid #d4af37;
        }

        /* Status Indicators */
        .section-id {
            background: #061d28;
            color: #d4af37;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            border: 1px solid #d4af37;
        }

        .assignment-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-assigned { background: #2e7d32; color: white; }
        .status-unassigned { background: #8b4513; color: white; }

        /* Gender Color Coding */
        .male-section {
            background: #e6f3ff;
            border-left: 4px solid #061d28;
            padding: 10px;
            border-radius: 6px;
            margin: 5px 0;
        }

        .female-section {
            background: #fff8e6;
            border-left: 4px solid #d4af37;
            padding: 10px;
            border-radius: 6px;
            margin: 5px 0;
        }

        /* Notifications */
        .notification {
            padding: 12px;
            margin: 10px 0;
            border-radius: 6px;
            font-weight: 600;
        }

        .notification.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .notification.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .notification.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        /* Capacity Displays */
        .capacity-display {
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .capacity-positive { background: #e8f5e8; color: #2e7d32; }
        .capacity-negative { background: #fdeaea; color: #8b4513; }
        .capacity-zero { background: #fff8e6; color: #b8941f; }

        /* Scrollable Tables */
        .table-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-top: 10px;
        }

        /* Table Filtering and Sorting */
        .table-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-input {
            flex: 1;
            min-width: 200px;
            padding: 8px 12px;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            font-size: 14px;
        }

        .sort-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .sort-select {
            padding: 8px 12px;
            border: 2px solid #bdc3c7;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }

        /* Sortable Table Headers */
        .table th.sortable {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-right: 20px;
        }

        .table th.sortable:hover {
            background: #0f3a4a !important;
        }

        .table th.sortable::after {
            content: '↕️';
            position: absolute;
            right: 8px;
            opacity: 0.5;
            font-size: 12px;
        }

        .table th.sortable.sort-asc::after {
            content: '⬆️';
            opacity: 1;
        }

        .table th.sortable.sort-desc::after {
            content: '⬇️';
            opacity: 1;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .assignment-container {
                grid-template-columns: 1fr;
            }
            
            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tabs {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 5px;
            }
            
            .tab-button {
                padding: 8px 12px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Mount 2K Housing Management System</h1>
            <p>Mount St. Mary's University - Comprehensive Housing Solution</p>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('dashboard')">Dashboard</button>
            <button class="tab-button" onclick="switchTab('youth-groups')">Youth Groups</button>
            <button class="tab-button" onclick="switchTab('housing-rooms')">Housing Rooms</button>
            <button class="tab-button" onclick="switchTab('housing-assignments')">Housing Assignments</button>
            <button class="tab-button" onclick="switchTab('small-group-rooms')">Small Group Rooms</button>
            <button class="tab-button" onclick="switchTab('small-group-assignments')">Small Group Assignments</button>
            <button class="tab-button" onclick="switchTab('meal-colors')">Meal Color Assignments</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2>Overview Dashboard</h2>
            
            <div class="dashboard-stats">
                <div class="stat-card">
                    <h3 id="total-groups">0</h3>
                    <p>Total Youth Groups</p>
                </div>
                <div class="stat-card">
                    <h3 id="total-participants">0</h3>
                    <p>Total Participants</p>
                </div>
                <div class="stat-card">
                    <h3 id="groups-needing-housing">0</h3>
                    <p>Groups Needing Housing</p>
                </div>
                <div class="stat-card">
                    <h3 id="groups-needing-small-group">0</h3>
                    <p>Groups Needing Small Group</p>
                </div>
                <div class="stat-card">
                    <h3 id="groups-needing-meal-color">0</h3>
                    <p>Groups Needing Meal Color</p>
                </div>
            </div>

            <h3 style="margin: 20px 0 10px 0;">Housing Capacity Details</h3>
            <div class="dashboard-stats">
                <div class="stat-card" style="background: linear-gradient(135deg, #3498db, #2980b9); border-color: #3498db;">
                    <h3 id="male-housing-capacity">0</h3>
                    <p>🔵 Male Housing Capacity</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #3498db, #2980b9); border-color: #3498db;">
                    <h3 id="male-housing-used">0</h3>
                    <p>🔵 Male Housing Used</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #3498db, #2980b9); border-color: #3498db;">
                    <h3 id="male-housing-utilization">0%</h3>
                    <p>🔵 Male Housing Used %</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #9b59b6, #8e44ad); border-color: #9b59b6;">
                    <h3 id="female-housing-capacity">0</h3>
                    <p>🟣 Female Housing Capacity</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #9b59b6, #8e44ad); border-color: #9b59b6;">
                    <h3 id="female-housing-used">0</h3>
                    <p>🟣 Female Housing Used</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #9b59b6, #8e44ad); border-color: #9b59b6;">
                    <h3 id="female-housing-utilization">0%</h3>
                    <p>🟣 Female Housing Used %</p>
                </div>
            </div>

            <h3 style="margin: 20px 0 10px 0;">Small Group Room Capacity</h3>
            <div class="dashboard-stats">
                <div class="stat-card" style="background: linear-gradient(135deg, #27ae60, #229954); border-color: #27ae60;">
                    <h3 id="mixed-sg-capacity">0</h3>
                    <p>Mixed/Co-ed Room Capacity</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #27ae60, #229954); border-color: #27ae60;">
                    <h3 id="mixed-sg-used">0</h3>
                    <p>Mixed/Co-ed Rooms Used</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #27ae60, #229954); border-color: #27ae60;">
                    <h3 id="mixed-sg-utilization">0%</h3>
                    <p>Mixed/Co-ed Rooms Used %</p>
                </div>
                <div class="stat-card">
                    <h3 id="available-small-group-rooms">0</h3>
                    <p>Available Small Group Rooms</p>
                </div>
            </div>

            <h3 style="margin: 20px 0 10px 0;">General Statistics</h3>
            <div class="dashboard-stats">
                <div class="stat-card">
                    <h3 id="available-housing-rooms">0</h3>
                    <p>Available Housing Rooms</p>
                </div>
            </div>

            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="exportToCSV()">📥 Export Data to CSV</button>
                <button class="btn btn-success" onclick="saveData()">💾 Save Data</button>
                <button class="btn btn-warning" onclick="loadData()">📂 Load Data</button>
                <button class="btn btn-primary" onclick="exportCompleteHTML()">🌐 Export Complete HTML Site</button>
                <input type="file" id="load-file" accept=".json" style="display: none;" onchange="handleLoadFile(event)">
                <p style="font-size: 12px; color: #666; margin-top: 10px;">
                    💡 Tip: Press <strong>Cmd+S</strong> (Mac) or <strong>Ctrl+S</strong> (Windows) to quickly export complete HTML site
                </p>
            </div>

            <h3>Quick Parish Assignment Search</h3>
            <input type="text" class="search-bar" id="parish-search" placeholder="Search by Parish name, Group ID, Leader name, Seminarian SGL, or Phone..." oninput="performSearch()">
            
            <div id="search-results"></div>

            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px;">
                <h3>Assignment Overview</h3>
                <div id="assignment-overview"></div>
            </div>
        </div>

        <!-- Youth Groups Tab -->
        <div id="youth-groups" class="tab-content">
            <h2>Youth Group Management</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>Group ID *</label>
                    <input type="text" id="group-id" placeholder="Enter Group ID">
                </div>
                <div class="form-group">
                    <label>Parish Name *</label>
                    <input type="text" id="parish-name" placeholder="Enter Parish Name">
                </div>
                <div class="form-group">
                    <label>Group Leader</label>
                    <input type="text" id="group-leader" placeholder="Enter Leader Name">
                </div>
                <div class="form-group">
                    <label>Seminarian SGL</label>
                    <input type="text" id="seminarian-sgl" placeholder="Enter Seminarian Small Group Leader">
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" id="phone-number" placeholder="Enter Phone Number">
                </div>
                <div class="form-group">
                    <label>Male Teens</label>
                    <input type="number" id="male-teens" min="0" value="0">
                </div>
                <div class="form-group">
                    <label>Female Teens</label>
                    <input type="number" id="female-teens" min="0" value="0">
                </div>
                <div class="form-group">
                    <label>Male Chaperones</label>
                    <input type="number" id="male-chaperones" min="0" value="0">
                </div>
                <div class="form-group">
                    <label>Female Chaperones</label>
                    <input type="number" id="female-chaperones" min="0" value="0">
                </div>
            </div>
            
            <div class="form-group">
                <label>Special Accommodations</label>
                <textarea id="special-accommodations" placeholder="Enter any special accommodations (CPAP machine, wheelchair access, medical needs, etc.)"></textarea>
            </div>

            <div>
                <button class="btn btn-success" onclick="addYouthGroup()">Add Youth Group</button>
                <button class="btn btn-primary" onclick="updateYouthGroup()" id="update-group-btn" style="display:none;">Update Youth Group</button>
                <button class="btn btn-danger" onclick="deleteYouthGroup()" id="delete-group-btn" style="display:none;">Delete Group</button>
                <button class="btn btn-warning" onclick="cancelEdit()" id="cancel-edit-btn" style="display:none;">Cancel</button>
            </div>

            <div class="table-controls">
                <input type="text" class="filter-input" id="youth-groups-filter" placeholder="Filter by Parish, Group ID, Leader, Seminarian SGL, or Phone..." oninput="filterYouthGroupsTable()">
                <div class="sort-controls">
                    <label>Sort by:</label>
                    <select class="sort-select" id="youth-groups-sort" onchange="sortYouthGroupsTable()">
                        <option value="id">Group ID</option>
                        <option value="parish">Parish Name</option>
                        <option value="leader">Leader Name</option>
                        <option value="seminarianSgl">Seminarian SGL</option>
                        <option value="total">Total People</option>
                        <option value="maleTeens">Male Teens</option>
                        <option value="femaleTeens">Female Teens</option>
                        <option value="status">Assignment Status</option>
                    </select>
                    <button class="btn btn-warning" onclick="toggleYouthGroupsSortOrder()" id="youth-groups-sort-order">A→Z</button>
                </div>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th class="sortable" onclick="sortYouthGroupsBy('id')">Group ID</th>
                            <th class="sortable" onclick="sortYouthGroupsBy('parish')">Parish</th>
                            <th class="sortable" onclick="sortYouthGroupsBy('leader')">Leader</th>
                            <th class="sortable" onclick="sortYouthGroupsBy('seminarianSgl')">Seminarian SGL</th>
                            <th class="sortable" onclick="sortYouthGroupsBy('phone')">Phone</th>
                            <th class="sortable" onclick="sortYouthGroupsBy('maleTeens')">M Teens</th>
                            <th class="sortable" onclick="sortYouthGroupsBy('femaleTeens')">F Teens</th>
                            <th class="sortable" onclick="sortYouthGroupsBy('maleChaperones')">M Chap</th>
                            <th class="sortable" onclick="sortYouthGroupsBy('femaleChaperones')">F Chap</th>
                            <th class="sortable" onclick="sortYouthGroupsBy('total')">Total</th>
                            <th>Special Needs</th>
                            <th class="sortable" onclick="sortYouthGroupsBy('status')">Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="youth-groups-table"></tbody>
                </table>
            </div>
        </div>

        <!-- Housing Rooms Tab -->
        <div id="housing-rooms" class="tab-content">
            <h2>Housing Room Management</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>Building Name *</label>
                    <input type="text" id="building-name" placeholder="e.g., Gymnasium, Auditorium">
                </div>
                <div class="form-group">
                    <label>Room/Section ID *</label>
                    <input type="text" id="room-id" placeholder="e.g., East Section, Orchestra Level">
                </div>
                <div class="form-group">
                    <label>Gender Designation *</label>
                    <select id="gender-designation">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Total Capacity *</label>
                    <input type="number" id="room-capacity" min="1" placeholder="Number of people">
                </div>
            </div>
            
            <div class="form-group">
                <label>Accessibility Features</label>
                <textarea id="accessibility-features" placeholder="Wheelchair accessible, ground floor, etc."></textarea>
            </div>

            <div>
                <button class="btn btn-success" onclick="addHousingRoom()">Add Housing Room</button>
                <button class="btn btn-primary" onclick="updateHousingRoom()" id="update-room-btn" style="display:none;">Update Room</button>
                <button class="btn btn-danger" onclick="deleteHousingRoom()" id="delete-room-btn" style="display:none;">Delete Room</button>
                <button class="btn btn-warning" onclick="cancelRoomEdit()" id="cancel-room-edit-btn" style="display:none;">Cancel</button>
            </div>

            <div class="table-controls">
                <input type="text" class="filter-input" id="housing-rooms-filter" placeholder="Filter by Building, Room, or Features..." oninput="filterHousingRoomsTable()">
                <div class="sort-controls">
                    <label>Sort by:</label>
                    <select class="sort-select" id="housing-rooms-sort" onchange="sortHousingRoomsTable()">
                        <option value="building">Building</option>
                        <option value="roomId">Room/Section</option>
                        <option value="gender">Gender</option>
                        <option value="capacity">Capacity</option>
                        <option value="occupied">Occupied</option>
                        <option value="available">Available Space</option>
                    </select>
                    <button class="btn btn-warning" onclick="toggleHousingRoomsSortOrder()" id="housing-rooms-sort-order">A→Z</button>
                </div>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th class="sortable" onclick="sortHousingRoomsBy('sectionId')">Section ID</th>
                            <th class="sortable" onclick="sortHousingRoomsBy('building')">Building</th>
                            <th class="sortable" onclick="sortHousingRoomsBy('roomId')">Room/Section</th>
                            <th class="sortable" onclick="sortHousingRoomsBy('gender')">Gender</th>
                            <th class="sortable" onclick="sortHousingRoomsBy('capacity')">Capacity</th>
                            <th class="sortable" onclick="sortHousingRoomsBy('occupied')">Occupied</th>
                            <th class="sortable" onclick="sortHousingRoomsBy('available')">Available</th>
                            <th>Accessibility</th>
                            <th>Assigned Groups</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="housing-rooms-table"></tbody>
                </table>
            </div>
        </div>

        <!-- Housing Assignments Tab -->
        <div id="housing-assignments" class="tab-content">
            <h2>Housing Room Assignments</h2>
            
            <div class="form-group">
                <label>Search Groups</label>
                <input type="text" class="search-bar" id="housing-assignment-search" placeholder="Search by Parish name, Group ID, or Leader name..." oninput="filterHousingAssignmentDropdown()">
            </div>
            
            <div class="form-group">
                <label>Select Group Gender Assignment</label>
                <select id="housing-assignment-group-select" onchange="selectGroupForHousingAssignment()">
                    <option value="">Select a Group-Gender Assignment</option>
                </select>
            </div>

            <div class="assignment-container">
                <div class="group-details">
                    <h3>Selected Assignment Details</h3>
                    <div id="housing-selected-group-info">
                        <p>Please select a group-gender assignment above to see room options.</p>
                    </div>
                </div>

                <div class="available-rooms">
                    <h3>Available Housing Rooms</h3>
                    <div id="housing-available-rooms-list">
                        <p>Select a group-gender assignment to see matching rooms.</p>
                    </div>
                </div>
            </div>

            <div id="housing-assignment-actions" style="display:none; margin-top: 20px; text-align: center;">
                <button class="btn btn-success" onclick="confirmHousingAssignment()">Save Housing Assignment</button>
                <button class="btn btn-danger" onclick="clearHousingAssignment()">Clear Assignment</button>
                <button class="btn btn-warning" onclick="cancelHousingSelection()">Cancel</button>
            </div>
        </div>

        <!-- Small Group Rooms Tab -->
        <div id="small-group-rooms" class="tab-content">
            <h2>Small Group Meeting Room Management</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>Building Name *</label>
                    <input type="text" id="sg-building-name" placeholder="e.g., Student Center, Library">
                </div>
                <div class="form-group">
                    <label>Room/Location ID *</label>
                    <input type="text" id="sg-room-id" placeholder="e.g., Conference Room A, Study Hall">
                </div>
                <div class="form-group">
                    <label>Gender Designation *</label>
                    <select id="sg-gender-designation">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="mixed">Mixed/Co-ed</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Room Capacity *</label>
                    <input type="number" id="sg-room-capacity" min="1" placeholder="Number of people">
                </div>
            </div>
            
            <div class="form-group">
                <label>Room Features</label>
                <textarea id="sg-room-features" placeholder="Projector, whiteboard, tables/chairs setup, etc."></textarea>
            </div>

            <div>
                <button class="btn btn-success" onclick="addSmallGroupRoom()">Add Small Group Room</button>
                <button class="btn btn-primary" onclick="updateSmallGroupRoom()" id="update-sg-room-btn" style="display:none;">Update Room</button>
                <button class="btn btn-danger" onclick="deleteSmallGroupRoom()" id="delete-sg-room-btn" style="display:none;">Delete Room</button>
                <button class="btn btn-warning" onclick="cancelSmallGroupRoomEdit()" id="cancel-sg-room-edit-btn" style="display:none;">Cancel</button>
            </div>

            <div class="table-controls">
                <input type="text" class="filter-input" id="small-group-rooms-filter" placeholder="Filter by Building, Room, or Features..." oninput="filterSmallGroupRoomsTable()">
                <div class="sort-controls">
                    <label>Sort by:</label>
                    <select class="sort-select" id="small-group-rooms-sort" onchange="sortSmallGroupRoomsTable()">
                        <option value="building">Building</option>
                        <option value="roomId">Room/Location</option>
                        <option value="gender">Gender</option>
                        <option value="capacity">Capacity</option>
                        <option value="occupied">Occupied</option>
                        <option value="available">Available Space</option>
                    </select>
                    <button class="btn btn-warning" onclick="toggleSmallGroupRoomsSortOrder()" id="small-group-rooms-sort-order">A→Z</button>
                </div>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th class="sortable" onclick="sortSmallGroupRoomsBy('locationId')">Location ID</th>
                            <th class="sortable" onclick="sortSmallGroupRoomsBy('building')">Building</th>
                            <th class="sortable" onclick="sortSmallGroupRoomsBy('roomId')">Room/Location</th>
                            <th class="sortable" onclick="sortSmallGroupRoomsBy('gender')">Gender</th>
                            <th class="sortable" onclick="sortSmallGroupRoomsBy('capacity')">Capacity</th>
                            <th class="sortable" onclick="sortSmallGroupRoomsBy('occupied')">Occupied</th>
                            <th class="sortable" onclick="sortSmallGroupRoomsBy('available')">Available</th>
                            <th>Features</th>
                            <th>Assigned Groups</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="small-group-rooms-table"></tbody>
                </table>
            </div>
        </div>

        <!-- Small Group Assignments Tab -->
        <div id="small-group-assignments" class="tab-content">
            <h2>Small Group Location Assignments</h2>
            
            <div class="form-group">
                <label>Search Groups</label>
                <input type="text" class="search-bar" id="sg-assignment-search" placeholder="Search by Parish name, Group ID, or Leader name..." oninput="filterSmallGroupAssignmentDropdown()">
            </div>
            
            <div class="form-group">
                <label>Select Group for Small Group Assignment</label>
                <select id="sg-assignment-group-select" onchange="selectGroupForSmallGroupAssignment()">
                    <option value="">Select a Group for Small Group Assignment</option>
                </select>
            </div>

            <div class="assignment-container">
                <div class="group-details">
                    <h3>Selected Group Details</h3>
                    <div id="sg-selected-group-info">
                        <p>Please select a group above to see small group location options.</p>
                    </div>
                </div>

                <div class="available-rooms">
                    <h3>Available Small Group Locations</h3>
                    <div id="sg-available-rooms-list">
                        <p>Select a group to see available small group locations.</p>
                    </div>
                </div>
            </div>

            <div id="sg-assignment-actions" style="display:none; margin-top: 20px; text-align: center;">
                <button class="btn btn-success" onclick="confirmSmallGroupAssignment()">Save Small Group Assignment</button>
                <button class="btn btn-danger" onclick="clearSmallGroupAssignment()">Clear Assignment</button>
                <button class="btn btn-warning" onclick="cancelSmallGroupSelection()">Cancel</button>
            </div>
        </div>

        <!-- Meal Color Assignments Tab -->
        <div id="meal-colors" class="tab-content">
            <h2>Meal Color Assignments</h2>
            
            <!-- Meal Color Summary Dashboard -->
            <div class="dashboard-stats" style="margin-bottom: 20px;">
                <div class="stat-card" style="background: linear-gradient(135deg, #3498db, #2980b9); border-color: #3498db;">
                    <h3 id="blue-meal-count">0</h3>
                    <p>🔵 Blue Teams</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #e74c3c, #c0392b); border-color: #e74c3c;">
                    <h3 id="red-meal-count">0</h3>
                    <p>🔴 Red Teams</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #e67e22, #d35400); border-color: #e67e22;">
                    <h3 id="orange-meal-count">0</h3>
                    <p>🟠 Orange Teams</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f1c40f, #f39c12); border-color: #f1c40f;">
                    <h3 id="yellow-meal-count">0</h3>
                    <p>🟡 Yellow Teams</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #27ae60, #229954); border-color: #27ae60;">
                    <h3 id="green-meal-count">0</h3>
                    <p>🟢 Green Teams</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #9b59b6, #8e44ad); border-color: #9b59b6;">
                    <h3 id="purple-meal-count">0</h3>
                    <p>🟣 Purple Teams</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #8b4513, #654321); border-color: #8b4513;">
                    <h3 id="brown-meal-count">0</h3>
                    <p>🤎 Brown Teams</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #95a5a6, #7f8c8d); border-color: #95a5a6;">
                    <h3 id="grey-meal-count">0</h3>
                    <p>⚪ Grey Teams</p>
                </div>
            </div>

            <div class="table-controls">
                <input type="text" class="filter-input" id="meal-colors-filter" placeholder="Filter by Parish, Group ID, or Leader..." oninput="filterMealColorsTable()">
                <div class="sort-controls">
                    <label>Sort by:</label>
                    <select class="sort-select" id="meal-colors-sort" onchange="sortMealColorsTable()">
                        <option value="id">Group ID</option>
                        <option value="parish">Parish Name</option>
                        <option value="total">Total People</option>
                        <option value="color">Meal Color</option>
                    </select>
                    <button class="btn btn-warning" onclick="toggleMealColorsSortOrder()" id="meal-colors-sort-order">A→Z</button>
                </div>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th class="sortable" onclick="sortMealColorsBy('id')">Group ID</th>
                            <th class="sortable" onclick="sortMealColorsBy('parish')">Parish</th>
                            <th class="sortable" onclick="sortMealColorsBy('leader')">Leader</th>
                            <th class="sortable" onclick="sortMealColorsBy('total')">Total People</th>
                            <th class="sortable" onclick="sortMealColorsBy('color')">Meal Color</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="meal-colors-table"></tbody>
                </table>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" onclick="confirmMealColorAssignments()" style="font-size: 16px; padding: 12px 24px;">Save Meal Colors</button>
            </div>
        </div>
    </div>

    <script>
        // ===== GLOBAL VARIABLES =====
        let appData = {
            youthGroups: [],
            housingRooms: [],
            smallGroupRooms: [],
            housingAssignments: {
                male: {},
                female: {}
            },
            smallGroupAssignments: {},
            mealColorAssignments: {}
        };

        let editingGroupIndex = -1;
        let editingHousingRoomIndex = -1;
        let editingSmallGroupRoomIndex = -1;
        let selectedHousingAssignment = null;
        let selectedSmallGroupAssignment = null;

        // GitHub Configuration
        const GITHUB_CONFIG = {
            username: 'M2KPortal',
            repo: 'M2KPortal.github.io',
            branch: 'main',
            filename: 'm2k_2026_housing_data (1).json',
            token: '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'
        };

        // Available meal colors
        const MEAL_COLORS = ['Blue', 'Red', 'Orange', 'Yellow', 'Green', 'Purple', 'Brown', 'Grey'];

        // Sorting state
        let sortStates = {
            youthGroups: { field: null, ascending: true },
            housingRooms: { field: null, ascending: true },
            smallGroupRooms: { field: null, ascending: true },
            mealColors: { field: null, ascending: true }
        };

        // ===== TABLE FILTERING AND SORTING FUNCTIONS =====
        
        // Youth Groups Table Filtering and Sorting
        function filterYouthGroupsTable() {
            const filterValue = document.getElementById('youth-groups-filter').value.toLowerCase();
            const tbody = document.getElementById('youth-groups-table');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const cells = row.getElementsByTagName('td');
                let showRow = false;
                
                // Check Group ID, Parish, Leader, Seminarian SGL, Phone
                for (let j = 0; j < 5; j++) {
                    if (cells[j] && cells[j].textContent.toLowerCase().includes(filterValue)) {
                        showRow = true;
                        break;
                    }
                }
                
                row.style.display = showRow ? '' : 'none';
            }
        }

        function sortYouthGroupsTable() {
            const sortField = document.getElementById('youth-groups-sort').value;
            sortYouthGroupsBy(sortField);
        }

        function sortYouthGroupsBy(field) {
            const isNewField = sortStates.youthGroups.field !== field;
            sortStates.youthGroups.field = field;
            
            if (isNewField) {
                sortStates.youthGroups.ascending = true;
            } else {
                sortStates.youthGroups.ascending = !sortStates.youthGroups.ascending;
            }
            
            updateSortHeaders('youth-groups-table', field, sortStates.youthGroups.ascending);
            updateYouthGroupsTable();
            updateSortOrderButton('youth-groups-sort-order', sortStates.youthGroups.ascending);
        }

        function toggleYouthGroupsSortOrder() {
            if (sortStates.youthGroups.field) {
                sortStates.youthGroups.ascending = !sortStates.youthGroups.ascending;
                updateYouthGroupsTable();
                updateSortOrderButton('youth-groups-sort-order', sortStates.youthGroups.ascending);
            }
        }

        // Housing Rooms Table Filtering and Sorting
        function filterHousingRoomsTable() {
            const filterValue = document.getElementById('housing-rooms-filter').value.toLowerCase();
            const tbody = document.getElementById('housing-rooms-table');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const cells = row.getElementsByTagName('td');
                let showRow = false;
                
                // Check Building, Room, Accessibility
                if ((cells[1] && cells[1].textContent.toLowerCase().includes(filterValue)) ||
                    (cells[2] && cells[2].textContent.toLowerCase().includes(filterValue)) ||
                    (cells[7] && cells[7].textContent.toLowerCase().includes(filterValue))) {
                    showRow = true;
                }
                
                row.style.display = showRow ? '' : 'none';
            }
        }

        function sortHousingRoomsTable() {
            const sortField = document.getElementById('housing-rooms-sort').value;
            sortHousingRoomsBy(sortField);
        }

        function sortHousingRoomsBy(field) {
            const isNewField = sortStates.housingRooms.field !== field;
            sortStates.housingRooms.field = field;
            
            if (isNewField) {
                sortStates.housingRooms.ascending = true;
            } else {
                sortStates.housingRooms.ascending = !sortStates.housingRooms.ascending;
            }
            
            updateSortHeaders('housing-rooms-table', field, sortStates.housingRooms.ascending);
            updateHousingRoomsTable();
            updateSortOrderButton('housing-rooms-sort-order', sortStates.housingRooms.ascending);
        }

        function toggleHousingRoomsSortOrder() {
            if (sortStates.housingRooms.field) {
                sortStates.housingRooms.ascending = !sortStates.housingRooms.ascending;
                updateHousingRoomsTable();
                updateSortOrderButton('housing-rooms-sort-order', sortStates.housingRooms.ascending);
            }
        }

        // Small Group Rooms Table Filtering and Sorting
        function filterSmallGroupRoomsTable() {
            const filterValue = document.getElementById('small-group-rooms-filter').value.toLowerCase();
            const tbody = document.getElementById('small-group-rooms-table');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const cells = row.getElementsByTagName('td');
                let showRow = false;
                
                // Check Building, Room, Features
                if ((cells[1] && cells[1].textContent.toLowerCase().includes(filterValue)) ||
                    (cells[2] && cells[2].textContent.toLowerCase().includes(filterValue)) ||
                    (cells[7] && cells[7].textContent.toLowerCase().includes(filterValue))) {
                    showRow = true;
                }
                
                row.style.display = showRow ? '' : 'none';
            }
        }

        function sortSmallGroupRoomsTable() {
            const sortField = document.getElementById('small-group-rooms-sort').value;
            sortSmallGroupRoomsBy(sortField);
        }

        function sortSmallGroupRoomsBy(field) {
            const isNewField = sortStates.smallGroupRooms.field !== field;
            sortStates.smallGroupRooms.field = field;
            
            if (isNewField) {
                sortStates.smallGroupRooms.ascending = true;
            } else {
                sortStates.smallGroupRooms.ascending = !sortStates.smallGroupRooms.ascending;
            }
            
            updateSortHeaders('small-group-rooms-table', field, sortStates.smallGroupRooms.ascending);
            updateSmallGroupRoomsTable();
            updateSortOrderButton('small-group-rooms-sort-order', sortStates.smallGroupRooms.ascending);
        }

        function toggleSmallGroupRoomsSortOrder() {
            if (sortStates.smallGroupRooms.field) {
                sortStates.smallGroupRooms.ascending = !sortStates.smallGroupRooms.ascending;
                updateSmallGroupRoomsTable();
                updateSortOrderButton('small-group-rooms-sort-order', sortStates.smallGroupRooms.ascending);
            }
        }

        // Utility functions for sorting
        function updateSortHeaders(tableId, field, ascending) {
            const table = document.getElementById(tableId);
            const headers = table.querySelectorAll('th.sortable');
            
            headers.forEach(header => {
                header.classList.remove('sort-asc', 'sort-desc');
            });
            
            // Add sort class to the active header
            headers.forEach(header => {
                if (header.textContent.toLowerCase().includes(field.toLowerCase()) || 
                    header.onclick.toString().includes(`'${field}'`)) {
                    header.classList.add(ascending ? 'sort-asc' : 'sort-desc');
                }
            });
        }

        function updateSortOrderButton(buttonId, ascending) {
            const button = document.getElementById(buttonId);
            if (button) {
                button.textContent = ascending ? 'A→Z' : 'Z→A';
            }
        }

        function getSortedYouthGroups() {
            let sorted = [...appData.youthGroups];
            const { field, ascending } = sortStates.youthGroups;
            
            if (!field) return sorted;
            
            sorted.sort((a, b) => {
                let valueA, valueB;
                
                switch (field) {
                    case 'total':
                        valueA = a.maleTeens + a.femaleTeens + a.maleChaperones + a.femaleChaperones;
                        valueB = b.maleTeens + b.femaleTeens + b.maleChaperones + b.femaleChaperones;
                        break;
                    case 'status':
                        valueA = isGroupHousingAssigned(a.id) ? 1 : 0;
                        valueB = isGroupHousingAssigned(b.id) ? 1 : 0;
                        break;
                    case 'maleTeens':
                    case 'femaleTeens':
                    case 'maleChaperones':
                    case 'femaleChaperones':
                        valueA = a[field];
                        valueB = b[field];
                        break;
                    default:
                        valueA = (a[field] || '').toString().toLowerCase();
                        valueB = (b[field] || '').toString().toLowerCase();
                }
                
                if (typeof valueA === 'number') {
                    return ascending ? valueA - valueB : valueB - valueA;
                } else {
                    if (valueA < valueB) return ascending ? -1 : 1;
                    if (valueA > valueB) return ascending ? 1 : -1;
                    return 0;
                }
            });
            
            return sorted;
        }

        // Meal Colors Table Filtering and Sorting
        function filterMealColorsTable() {
            const filterValue = document.getElementById('meal-colors-filter').value.toLowerCase();
            const tbody = document.getElementById('meal-colors-table');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const cells = row.getElementsByTagName('td');
                let showRow = false;
                
                // Check Group ID, Parish, Leader
                for (let j = 0; j < 3; j++) {
                    if (cells[j] && cells[j].textContent.toLowerCase().includes(filterValue)) {
                        showRow = true;
                        break;
                    }
                }
                
                row.style.display = showRow ? '' : 'none';
            }
        }

        function sortMealColorsTable() {
            const sortField = document.getElementById('meal-colors-sort').value;
            sortMealColorsBy(sortField);
        }

        function sortMealColorsBy(field) {
            const isNewField = sortStates.mealColors.field !== field;
            sortStates.mealColors.field = field;
            
            if (isNewField) {
                sortStates.mealColors.ascending = true;
            } else {
                sortStates.mealColors.ascending = !sortStates.mealColors.ascending;
            }
            
            updateSortHeaders('meal-colors-table', field, sortStates.mealColors.ascending);
            updateMealColorsTable();
            updateSortOrderButton('meal-colors-sort-order', sortStates.mealColors.ascending);
        }

        function toggleMealColorsSortOrder() {
            if (sortStates.mealColors.field) {
                sortStates.mealColors.ascending = !sortStates.mealColors.ascending;
                updateMealColorsTable();
                updateSortOrderButton('meal-colors-sort-order', sortStates.mealColors.ascending);
            }
        }

        function getSortedMealColorGroups() {
            let sorted = [...appData.youthGroups];
            const { field, ascending } = sortStates.mealColors;
            
            if (!field) return sorted;
            
            sorted.sort((a, b) => {
                let valueA, valueB;
                
                switch (field) {
                    case 'total':
                        valueA = a.maleTeens + a.femaleTeens + a.maleChaperones + a.femaleChaperones;
                        valueB = b.maleTeens + b.femaleTeens + b.maleChaperones + b.femaleChaperones;
                        break;
                    case 'color':
                        valueA = appData.mealColorAssignments[a.id] || '';
                        valueB = appData.mealColorAssignments[b.id] || '';
                        break;
                    default:
                        valueA = (a[field] || '').toString().toLowerCase();
                        valueB = (b[field] || '').toString().toLowerCase();
                }
                
                if (typeof valueA === 'number') {
                    return ascending ? valueA - valueB : valueB - valueA;
                } else {
                    if (valueA < valueB) return ascending ? -1 : 1;
                    if (valueA > valueB) return ascending ? 1 : -1;
                    return 0;
                }
            });
            
            return sorted;
        }

        function getSortedHousingRooms() {
            let sorted = [...appData.housingRooms];
            const { field, ascending } = sortStates.housingRooms;
            
            if (!field) return sorted;
            
            sorted.sort((a, b) => {
                let valueA, valueB;
                
                switch (field) {
                    case 'occupied':
                        valueA = getHousingRoomOccupancy(`${a.building}-${a.roomId}`);
                        valueB = getHousingRoomOccupancy(`${b.building}-${b.roomId}`);
                        break;
                    case 'available':
                        valueA = a.capacity - getHousingRoomOccupancy(`${a.building}-${a.roomId}`);
                        valueB = b.capacity - getHousingRoomOccupancy(`${b.building}-${b.roomId}`);
                        break;
                    case 'sectionId':
                        valueA = `${a.building.substring(0, 3).toUpperCase()}-${a.roomId}`;
                        valueB = `${b.building.substring(0, 3).toUpperCase()}-${b.roomId}`;
                        break;
                    case 'capacity':
                        valueA = a.capacity;
                        valueB = b.capacity;
                        break;
                    default:
                        valueA = (a[field] || '').toString().toLowerCase();
                        valueB = (b[field] || '').toString().toLowerCase();
                }
                
                if (typeof valueA === 'number') {
                    return ascending ? valueA - valueB : valueB - valueA;
                } else {
                    if (valueA < valueB) return ascending ? -1 : 1;
                    if (valueA > valueB) return ascending ? 1 : -1;
                    return 0;
                }
            });
            
            return sorted;
        }

        function getSortedSmallGroupRooms() {
            let sorted = [...appData.smallGroupRooms];
            const { field, ascending } = sortStates.smallGroupRooms;
            
            if (!field) return sorted;
            
            sorted.sort((a, b) => {
                let valueA, valueB;
                
                switch (field) {
                    case 'occupied':
                        valueA = getSmallGroupRoomOccupancy(`${a.building}-${a.roomId}`);
                        valueB = getSmallGroupRoomOccupancy(`${b.building}-${b.roomId}`);
                        break;
                    case 'available':
                        valueA = a.capacity - getSmallGroupRoomOccupancy(`${a.building}-${a.roomId}`);
                        valueB = b.capacity - getSmallGroupRoomOccupancy(`${b.building}-${b.roomId}`);
                        break;
                    case 'locationId':
                        valueA = `${a.building.substring(0, 3).toUpperCase()}-${a.roomId}`;
                        valueB = `${b.building.substring(0, 3).toUpperCase()}-${b.roomId}`;
                        break;
                    case 'capacity':
                        valueA = a.capacity;
                        valueB = b.capacity;
                        break;
                    default:
                        valueA = (a[field] || '').toString().toLowerCase();
                        valueB = (b[field] || '').toString().toLowerCase();
                }
                
                if (typeof valueA === 'number') {
                    return ascending ? valueA - valueB : valueB - valueA;
                } else {
                    if (valueA < valueB) return ascending ? -1 : 1;
                    if (valueA > valueB) return ascending ? 1 : -1;
                    return 0;
                }
            });
            
            return sorted;
        }

        // ===== SYSTEM INITIALIZATION =====
        function initializeSystem() {
            loadSampleData();
            updateAllDisplays();
            setupKeyboardShortcuts();
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(event) {
                // Check for Cmd+S (Mac) or Ctrl+S (Windows/Linux)
                if ((event.metaKey || event.ctrlKey) && event.key === 's') {
                    event.preventDefault(); // Prevent browser's default save
                    exportCompleteHTML();
                }
            });
        }

        function loadSampleData() {
            appData.youthGroups = [
                {
                    id: '4',
                    parish: 'St. Leo the Great Parish',
                    leader: 'Buchheit, Grace',
                    seminarianSgl: 'John Mark',
                    phone: '301 703-0497',
                    maleTeens: 27,
                    femaleTeens: 27,
                    maleChaperones: 3,
                    femaleChaperones: 3,
                    specialAccommodations: ''
                },
                {
                    id: '5',
                    parish: 'St. John The Evangelist (OC)',
                    leader: 'Dumaliang, Sr. Leilani, MCS',
                    seminarianSgl: '',
                    phone: 'Dumaliang, Sr. Leilani, MCS',
                    maleTeens: 30,
                    femaleTeens: 30,
                    maleChaperones: 5,
                    femaleChaperones: 5,
                    specialAccommodations: ''
                },
                {
                    id: '6',
                    parish: 'St. Josephs old Cathedral',
                    leader: 'Joel De Loera',
                    seminarianSgl: '',
                    phone: '405 900-1278',
                    maleTeens: 25,
                    femaleTeens: 5,
                    maleChaperones: 12,
                    femaleChaperones: 3,
                    specialAccommodations: ''
                },
                {
                    id: '7',
                    parish: 'Our Lady of Knotts',
                    leader: 'Sal Devito',
                    seminarianSgl: 'George Castiglia',
                    phone: '1248923',
                    maleTeens: 20,
                    femaleTeens: 40,
                    maleChaperones: 6,
                    femaleChaperones: 12,
                    specialAccommodations: ''
                },
                {
                    id: '8',
                    parish: 'St. Charles',
                    leader: 'William Sweeney',
                    seminarianSgl: 'Tim S',
                    phone: '53892193',
                    maleTeens: 4,
                    femaleTeens: 2,
                    maleChaperones: 2,
                    femaleChaperones: 2,
                    specialAccommodations: ''
                }
            ];

            appData.housingRooms = [
                {
                    building: 'Off Campus',
                    roomId: 'Male',
                    gender: 'male',
                    capacity: 400,
                    accessibility: ''
                },
                {
                    building: 'Off Campus',
                    roomId: 'Female',
                    gender: 'female',
                    capacity: 400,
                    accessibility: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '320',
                    gender: 'male',
                    capacity: 32,
                    accessibility: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '311',
                    gender: 'male',
                    capacity: 35,
                    accessibility: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '308',
                    gender: 'male',
                    capacity: 38,
                    accessibility: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '310',
                    gender: 'male',
                    capacity: 44,
                    accessibility: ''
                },
                {
                    building: 'ARCC',
                    roomId: 'GYM FLOOR',
                    gender: 'female',
                    capacity: 300,
                    accessibility: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '327',
                    gender: 'male',
                    capacity: 32,
                    accessibility: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '227',
                    gender: 'male',
                    capacity: 28,
                    accessibility: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '224',
                    gender: 'male',
                    capacity: 24,
                    accessibility: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '222',
                    gender: 'male',
                    capacity: 32,
                    accessibility: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '220',
                    gender: 'male',
                    capacity: 32,
                    accessibility: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '107',
                    gender: 'male',
                    capacity: 26,
                    accessibility: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '109',
                    gender: 'male',
                    capacity: 26,
                    accessibility: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '111',
                    gender: 'male',
                    capacity: 30,
                    accessibility: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '104',
                    gender: 'male',
                    capacity: 26,
                    accessibility: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '108',
                    gender: 'male',
                    capacity: 28,
                    accessibility: ''
                }
            ];

            appData.smallGroupRooms = [
                {
                    building: 'Knott Academic Center',
                    roomId: '304',
                    gender: 'mixed',
                    capacity: 26,
                    features: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '300- Lobby',
                    gender: 'mixed',
                    capacity: 18,
                    features: 'INSIDE WINDOWS- CHAIRS NEEDED'
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '308',
                    gender: 'mixed',
                    capacity: 33,
                    features: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '310',
                    gender: 'mixed',
                    capacity: 44,
                    features: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '311',
                    gender: 'mixed',
                    capacity: 44,
                    features: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '320',
                    gender: 'mixed',
                    capacity: 24,
                    features: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '327',
                    gender: 'mixed',
                    capacity: 33,
                    features: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '323',
                    gender: 'mixed',
                    capacity: 14,
                    features: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '207',
                    gender: 'mixed',
                    capacity: 25,
                    features: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '206',
                    gender: 'mixed',
                    capacity: 25,
                    features: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '209',
                    gender: 'mixed',
                    capacity: 20,
                    features: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '211',
                    gender: 'mixed',
                    capacity: 23,
                    features: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '210',
                    gender: 'mixed',
                    capacity: 36,
                    features: 'CHAIRS NEEDED'
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '100- End Coridor',
                    gender: 'mixed',
                    capacity: 10,
                    features: 'Chairs Needed'
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '200- Lobby',
                    gender: 'mixed',
                    capacity: 30,
                    features: 'Chairs needed'
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '208',
                    gender: 'mixed',
                    capacity: 26,
                    features: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '200- End Corridor',
                    gender: 'mixed',
                    capacity: 12,
                    features: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '127',
                    gender: 'mixed',
                    capacity: 25,
                    features: 'EXIT DOOR'
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '120',
                    gender: 'mixed',
                    capacity: 30,
                    features: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '100- Lounge',
                    gender: 'mixed',
                    capacity: 15,
                    features: 'Chairs Needed'
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '203',
                    gender: 'mixed',
                    capacity: 26,
                    features: ''
                },
                {
                    building: 'Knott Academic Center',
                    roomId: 'Gorund Floor Lobby',
                    gender: 'mixed',
                    capacity: 40,
                    features: 'Need Chairs'
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '3rd Floor Lobby',
                    gender: 'mixed',
                    capacity: 50,
                    features: 'Need Chairs'
                },
                {
                    building: 'PAC',
                    roomId: 'Upper Level',
                    gender: 'mixed',
                    capacity: 30,
                    features: 'Chairs Needed'
                },
                {
                    building: 'PAC',
                    roomId: 'Lower Level',
                    gender: 'mixed',
                    capacity: 100,
                    features: 'Chairs Needed'
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '300- End Coridor',
                    gender: 'mixed',
                    capacity: 12,
                    features: 'CHAIRS NEEDED'
                },
                {
                    building: 'Knott Academic Center',
                    roomId: '300- Lobby O/G',
                    gender: 'mixed',
                    capacity: 35,
                    features: 'CHIARS NEEDED- OUTSIDE GLASS'
                },
                {
                    building: 'COAD Science Building',
                    roomId: '158',
                    gender: 'mixed',
                    capacity: 60,
                    features: 'Open Wall'
                },
                {
                    building: 'COAD Science Building',
                    roomId: '107',
                    gender: 'mixed',
                    capacity: 13,
                    features: ''
                },
                {
                    building: 'COAD Science Building',
                    roomId: '111',
                    gender: 'mixed',
                    capacity: 12,
                    features: ''
                },
                {
                    building: 'COAD Science Building',
                    roomId: '117',
                    gender: 'mixed',
                    capacity: 24,
                    features: ''
                },
                {
                    building: 'COAD Science Building',
                    roomId: '125',
                    gender: 'mixed',
                    capacity: 20,
                    features: ''
                },
                {
                    building: 'Knott Auditorium',
                    roomId: '200 Lobby',
                    gender: 'mixed',
                    capacity: 50,
                    features: ''
                },
                {
                    building: 'Knott Auditorium',
                    roomId: '100- West Lobby',
                    gender: 'mixed',
                    capacity: 25,
                    features: ''
                },
                {
                    building: 'Knott Auditorium',
                    roomId: '100- East Lobby',
                    gender: 'mixed',
                    capacity: 25,
                    features: ''
                },
                {
                    building: 'McGowan',
                    roomId: 'Lobby',
                    gender: 'mixed',
                    capacity: 25,
                    features: ''
                },
                {
                    building: 'McGowan',
                    roomId: 'Stair Pavillion',
                    gender: 'mixed',
                    capacity: 20,
                    features: ''
                }
            ];

            appData.housingAssignments = {
                male: {
                    '4': ['Knott Academic Center-320']
                },
                female: {}
            };
            
            appData.smallGroupAssignments = {};
            
            appData.mealColorAssignments = {};
        }

        // ===== TAB MANAGEMENT =====
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'housing-assignments') {
                updateHousingAssignmentDropdown();
            } else if (tabName === 'small-group-assignments') {
                updateSmallGroupAssignmentDropdown();
            } else if (tabName === 'meal-colors') {
                updateMealColorsTable();
                updateMealColorSummary();
            }
        }

        // ===== YOUTH GROUP MANAGEMENT =====
        function addYouthGroup() {
            const groupData = getYouthGroupFormData();
            if (!validateYouthGroupData(groupData)) return;

            appData.youthGroups.push(groupData);
            clearYouthGroupForm();
            updateAllDisplays();
            autoSave();
        }

        function updateYouthGroup() {
            if (editingGroupIndex < 0) return;
            
            const groupData = getYouthGroupFormData();
            if (!validateYouthGroupData(groupData)) return;

            const oldId = appData.youthGroups[editingGroupIndex].id;
            appData.youthGroups[editingGroupIndex] = groupData;
            
            if (oldId !== groupData.id) {
                updateAssignmentIds(oldId, groupData.id);
            }
            
            cancelEdit();
            updateAllDisplays();
            autoSave();
        }

        function editYouthGroup(index) {
            const group = appData.youthGroups[index];
            populateYouthGroupForm(group);
            editingGroupIndex = index;
            showEditButtons();
        }

        function deleteYouthGroup() {
            if (editingGroupIndex < 0) return;
            
            if (confirm('Are you sure you want to delete this youth group and all its assignments?')) {
                const groupId = appData.youthGroups[editingGroupIndex].id;
                
                delete appData.housingAssignments.male[groupId];
                delete appData.housingAssignments.female[groupId];
                delete appData.smallGroupAssignments[groupId];
                
                appData.youthGroups.splice(editingGroupIndex, 1);
                cancelEdit();
                updateAllDisplays();
                autoSave();
            }
        }

        function cancelEdit() {
            editingGroupIndex = -1;
            clearYouthGroupForm();
            hideEditButtons();
        }

        function getYouthGroupFormData() {
            return {
                id: document.getElementById('group-id').value.trim(),
                parish: document.getElementById('parish-name').value.trim(),
                leader: document.getElementById('group-leader').value.trim(),
                seminarianSgl: document.getElementById('seminarian-sgl').value.trim(),
                phone: document.getElementById('phone-number').value.trim(),
                maleTeens: parseInt(document.getElementById('male-teens').value) || 0,
                femaleTeens: parseInt(document.getElementById('female-teens').value) || 0,
                maleChaperones: parseInt(document.getElementById('male-chaperones').value) || 0,
                femaleChaperones: parseInt(document.getElementById('female-chaperones').value) || 0,
                specialAccommodations: document.getElementById('special-accommodations').value.trim()
            };
        }

        function validateYouthGroupData(data) {
            if (!data.id || !data.parish) {
                alert('Please fill in Group ID and Parish Name (required fields)');
                return false;
            }
            
            const existingIndex = appData.youthGroups.findIndex(g => g.id === data.id);
            if (existingIndex !== -1 && existingIndex !== editingGroupIndex) {
                alert('A group with this ID already exists');
                return false;
            }
            
            return true;
        }

        function populateYouthGroupForm(group) {
            document.getElementById('group-id').value = group.id;
            document.getElementById('parish-name').value = group.parish;
            document.getElementById('group-leader').value = group.leader;
            document.getElementById('seminarian-sgl').value = group.seminarianSgl || '';
            document.getElementById('phone-number').value = group.phone;
            document.getElementById('male-teens').value = group.maleTeens;
            document.getElementById('female-teens').value = group.femaleTeens;
            document.getElementById('male-chaperones').value = group.maleChaperones;
            document.getElementById('female-chaperones').value = group.femaleChaperones;
            document.getElementById('special-accommodations').value = group.specialAccommodations;
        }

        function clearYouthGroupForm() {
            document.getElementById('group-id').value = '';
            document.getElementById('parish-name').value = '';
            document.getElementById('group-leader').value = '';
            document.getElementById('seminarian-sgl').value = '';
            document.getElementById('phone-number').value = '';
            document.getElementById('male-teens').value = '0';
            document.getElementById('female-teens').value = '0';
            document.getElementById('male-chaperones').value = '0';
            document.getElementById('female-chaperones').value = '0';
            document.getElementById('special-accommodations').value = '';
        }

        function showEditButtons() {
            document.getElementById('update-group-btn').style.display = 'inline-block';
            document.getElementById('delete-group-btn').style.display = 'inline-block';
            document.getElementById('cancel-edit-btn').style.display = 'inline-block';
        }

        function hideEditButtons() {
            document.getElementById('update-group-btn').style.display = 'none';
            document.getElementById('delete-group-btn').style.display = 'none';
            document.getElementById('cancel-edit-btn').style.display = 'none';
        }

        function updateAssignmentIds(oldId, newId) {
            if (appData.housingAssignments.male[oldId]) {
                appData.housingAssignments.male[newId] = appData.housingAssignments.male[oldId];
                delete appData.housingAssignments.male[oldId];
            }
            if (appData.housingAssignments.female[oldId]) {
                appData.housingAssignments.female[newId] = appData.housingAssignments.female[oldId];
                delete appData.housingAssignments.female[oldId];
            }
            if (appData.smallGroupAssignments[oldId]) {
                appData.smallGroupAssignments[newId] = appData.smallGroupAssignments[oldId];
                delete appData.smallGroupAssignments[oldId];
            }
        }

        // ===== HOUSING ROOM MANAGEMENT =====
        function addHousingRoom() {
            const roomData = getHousingRoomFormData();
            if (!validateHousingRoomData(roomData)) return;

            appData.housingRooms.push(roomData);
            clearHousingRoomForm();
            updateAllDisplays();
            autoSave();
        }

        function updateHousingRoom() {
            if (editingHousingRoomIndex < 0) return;
            
            const roomData = getHousingRoomFormData();
            if (!validateHousingRoomData(roomData)) return;

            appData.housingRooms[editingHousingRoomIndex] = roomData;
            cancelRoomEdit();
            updateAllDisplays();
            autoSave();
        }

        function editHousingRoom(index) {
            const room = appData.housingRooms[index];
            populateHousingRoomForm(room);
            editingHousingRoomIndex = index;
            showRoomEditButtons();
        }

        function deleteHousingRoom() {
            if (editingHousingRoomIndex < 0) return;
            
            if (confirm('Are you sure you want to delete this housing room and all its assignments?')) {
                const room = appData.housingRooms[editingHousingRoomIndex];
                const roomKey = `${room.building}-${room.roomId}`;
                
                removeRoomFromHousingAssignments(roomKey);
                
                appData.housingRooms.splice(editingHousingRoomIndex, 1);
                cancelRoomEdit();
                updateAllDisplays();
                autoSave();
            }
        }

        function cancelRoomEdit() {
            editingHousingRoomIndex = -1;
            clearHousingRoomForm();
            hideRoomEditButtons();
        }

        function getHousingRoomFormData() {
            return {
                building: document.getElementById('building-name').value.trim(),
                roomId: document.getElementById('room-id').value.trim(),
                gender: document.getElementById('gender-designation').value,
                capacity: parseInt(document.getElementById('room-capacity').value) || 0,
                accessibility: document.getElementById('accessibility-features').value.trim()
            };
        }

        function validateHousingRoomData(data) {
            if (!data.building || !data.roomId || !data.gender || data.capacity < 1) {
                alert('Please fill in all required housing room fields');
                return false;
            }
            
            const roomKey = `${data.building}-${data.roomId}`;
            const existingIndex = appData.housingRooms.findIndex(r => `${r.building}-${r.roomId}` === roomKey);
            if (existingIndex !== -1 && existingIndex !== editingHousingRoomIndex) {
                alert('A housing room with this building and room ID already exists');
                return false;
            }
            
            return true;
        }

        function populateHousingRoomForm(room) {
            document.getElementById('building-name').value = room.building;
            document.getElementById('room-id').value = room.roomId;
            document.getElementById('gender-designation').value = room.gender;
            document.getElementById('room-capacity').value = room.capacity;
            document.getElementById('accessibility-features').value = room.accessibility;
        }

        function clearHousingRoomForm() {
            document.getElementById('building-name').value = '';
            document.getElementById('room-id').value = '';
            document.getElementById('gender-designation').value = '';
            document.getElementById('room-capacity').value = '';
            document.getElementById('accessibility-features').value = '';
        }

        function showRoomEditButtons() {
            document.getElementById('update-room-btn').style.display = 'inline-block';
            document.getElementById('delete-room-btn').style.display = 'inline-block';
            document.getElementById('cancel-room-edit-btn').style.display = 'inline-block';
        }

        function hideRoomEditButtons() {
            document.getElementById('update-room-btn').style.display = 'none';
            document.getElementById('delete-room-btn').style.display = 'none';
            document.getElementById('cancel-room-edit-btn').style.display = 'none';
        }

        function removeRoomFromHousingAssignments(roomKey) {
            Object.keys(appData.housingAssignments.male).forEach(groupId => {
                if (Array.isArray(appData.housingAssignments.male[groupId])) {
                    appData.housingAssignments.male[groupId] = appData.housingAssignments.male[groupId].filter(key => key !== roomKey);
                    if (appData.housingAssignments.male[groupId].length === 0) {
                        delete appData.housingAssignments.male[groupId];
                    }
                }
            });
            Object.keys(appData.housingAssignments.female).forEach(groupId => {
                if (Array.isArray(appData.housingAssignments.female[groupId])) {
                    appData.housingAssignments.female[groupId] = appData.housingAssignments.female[groupId].filter(key => key !== roomKey);
                    if (appData.housingAssignments.female[groupId].length === 0) {
                        delete appData.housingAssignments.female[groupId];
                    }
                }
            });
        }

        // ===== SMALL GROUP ROOM MANAGEMENT =====
        function addSmallGroupRoom() {
            const roomData = getSmallGroupRoomFormData();
            if (!validateSmallGroupRoomData(roomData)) return;

            appData.smallGroupRooms.push(roomData);
            clearSmallGroupRoomForm();
            updateAllDisplays();
            autoSave();
        }

        function updateSmallGroupRoom() {
            if (editingSmallGroupRoomIndex < 0) return;
            
            const roomData = getSmallGroupRoomFormData();
            if (!validateSmallGroupRoomData(roomData)) return;

            appData.smallGroupRooms[editingSmallGroupRoomIndex] = roomData;
            cancelSmallGroupRoomEdit();
            updateAllDisplays();
            autoSave();
        }

        function editSmallGroupRoom(index) {
            const room = appData.smallGroupRooms[index];
            populateSmallGroupRoomForm(room);
            editingSmallGroupRoomIndex = index;
            showSmallGroupRoomEditButtons();
        }

        function deleteSmallGroupRoom() {
            if (editingSmallGroupRoomIndex < 0) return;
            
            if (confirm('Are you sure you want to delete this small group room and all its assignments?')) {
                const room = appData.smallGroupRooms[editingSmallGroupRoomIndex];
                const roomKey = `${room.building}-${room.roomId}`;
                
                removeRoomFromSmallGroupAssignments(roomKey);
                
                appData.smallGroupRooms.splice(editingSmallGroupRoomIndex, 1);
                cancelSmallGroupRoomEdit();
                updateAllDisplays();
                autoSave();
            }
        }

        function cancelSmallGroupRoomEdit() {
            editingSmallGroupRoomIndex = -1;
            clearSmallGroupRoomForm();
            hideSmallGroupRoomEditButtons();
        }

        function getSmallGroupRoomFormData() {
            return {
                building: document.getElementById('sg-building-name').value.trim(),
                roomId: document.getElementById('sg-room-id').value.trim(),
                gender: document.getElementById('sg-gender-designation').value,
                capacity: parseInt(document.getElementById('sg-room-capacity').value) || 0,
                features: document.getElementById('sg-room-features').value.trim()
            };
        }

        function validateSmallGroupRoomData(data) {
            if (!data.building || !data.roomId || !data.gender || data.capacity < 1) {
                alert('Please fill in all required small group room fields');
                return false;
            }
            
            const roomKey = `${data.building}-${data.roomId}`;
            const existingIndex = appData.smallGroupRooms.findIndex(r => `${r.building}-${r.roomId}` === roomKey);
            if (existingIndex !== -1 && existingIndex !== editingSmallGroupRoomIndex) {
                alert('A small group room with this building and room ID already exists');
                return false;
            }
            
            return true;
        }

        function populateSmallGroupRoomForm(room) {
            document.getElementById('sg-building-name').value = room.building;
            document.getElementById('sg-room-id').value = room.roomId;
            document.getElementById('sg-gender-designation').value = room.gender;
            document.getElementById('sg-room-capacity').value = room.capacity;
            document.getElementById('sg-room-features').value = room.features;
        }

        function clearSmallGroupRoomForm() {
            document.getElementById('sg-building-name').value = '';
            document.getElementById('sg-room-id').value = '';
            document.getElementById('sg-gender-designation').value = '';
            document.getElementById('sg-room-capacity').value = '';
            document.getElementById('sg-room-features').value = '';
        }

        function showSmallGroupRoomEditButtons() {
            document.getElementById('update-sg-room-btn').style.display = 'inline-block';
            document.getElementById('delete-sg-room-btn').style.display = 'inline-block';
            document.getElementById('cancel-sg-room-edit-btn').style.display = 'inline-block';
        }

        function hideSmallGroupRoomEditButtons() {
            document.getElementById('update-sg-room-btn').style.display = 'none';
            document.getElementById('delete-sg-room-btn').style.display = 'none';
            document.getElementById('cancel-sg-room-edit-btn').style.display = 'none';
        }

        function removeRoomFromSmallGroupAssignments(roomKey) {
            Object.keys(appData.smallGroupAssignments).forEach(groupId => {
                if (Array.isArray(appData.smallGroupAssignments[groupId])) {
                    appData.smallGroupAssignments[groupId] = appData.smallGroupAssignments[groupId].filter(key => key !== roomKey);
                    if (appData.smallGroupAssignments[groupId].length === 0) {
                        delete appData.smallGroupAssignments[groupId];
                    }
                }
            });
        }

        // ===== HOUSING ASSIGNMENT MANAGEMENT =====
        function updateHousingAssignmentDropdown() {
            document.getElementById('housing-assignment-search').value = '';
            const select = document.getElementById('housing-assignment-group-select');
            select.innerHTML = '<option value="">Select a Group-Gender Assignment</option>';
            
            appData.youthGroups.forEach(group => {
                const maleTotal = group.maleTeens + group.maleChaperones;
                const femaleTotal = group.femaleTeens + group.femaleChaperones;
                
                if (maleTotal > 0) {
                    const option = document.createElement('option');
                    option.value = `${group.id}-male`;
                    option.textContent = `${group.id} - ${group.parish} - Males (${maleTotal} people)`;
                    select.appendChild(option);
                }
                
                if (femaleTotal > 0) {
                    const option = document.createElement('option');
                    option.value = `${group.id}-female`;
                    option.textContent = `${group.id} - ${group.parish} - Females (${femaleTotal} people)`;
                    select.appendChild(option);
                }
            });
        }

        function selectGroupForHousingAssignment() {
            const select = document.getElementById('housing-assignment-group-select');
            const value = select.value;
            
            if (!value) {
                selectedHousingAssignment = null;
                updateHousingAssignmentDisplay();
                return;
            }
            
            const [groupId, gender] = value.split('-');
            const group = appData.youthGroups.find(g => g.id === groupId);
            
            selectedHousingAssignment = {
                groupId: groupId,
                gender: gender,
                groupData: group
            };
            
            updateHousingAssignmentDisplay();
        }

        function updateHousingAssignmentDisplay() {
            updateSelectedHousingGroupInfo();
            updateAvailableHousingRoomsList();
            updateHousingAssignmentActions();
        }

        function updateSelectedHousingGroupInfo() {
            const infoDiv = document.getElementById('housing-selected-group-info');
            
            if (!selectedHousingAssignment) {
                infoDiv.innerHTML = '<p>Please select a group-gender assignment above to see room options.</p>';
                return;
            }
            
            const { groupId, gender, groupData } = selectedHousingAssignment;
            const peopleCount = gender === 'male' ? 
                (groupData.maleTeens + groupData.maleChaperones) : 
                (groupData.femaleTeens + groupData.femaleChaperones);
                
            const assignedRooms = appData.housingAssignments[gender][groupId] || [];
            const roomNames = assignedRooms.map(roomKey => {
                const room = appData.housingRooms.find(r => `${r.building}-${r.roomId}` === roomKey);
                return room ? `${room.building} - ${room.roomId}` : roomKey;
            });
            
            infoDiv.innerHTML = `
                <h4>${groupData.parish} (${groupId})</h4>
                <p><strong>Leader:</strong> ${groupData.leader}</p>
                <p><strong>Phone:</strong> ${groupData.phone}</p>
                <p><strong>${gender.charAt(0).toUpperCase() + gender.slice(1)} Total:</strong> ${peopleCount} people</p>
                ${gender === 'male' ? 
                    `<p>(${groupData.maleTeens} teens + ${groupData.maleChaperones} chaperones)</p>` :
                    `<p>(${groupData.femaleTeens} teens + ${groupData.femaleChaperones} chaperones)</p>`
                }
                ${groupData.specialAccommodations ? `<p><strong>Special Accommodations:</strong> ${groupData.specialAccommodations}</p>` : ''}
                
                ${assignedRooms.length > 0 ? `
                    <div class="${gender}-section">
                        <strong>Current Housing Assignments:</strong>
                        <p>${roomNames.join(', ')}</p>
                    </div>
                ` : `<p style="color: #e67e22;"><strong>⚠️ No ${gender} housing assignments yet.</strong></p>`}
            `;
        }

        function updateAvailableHousingRoomsList() {
            const roomsDiv = document.getElementById('housing-available-rooms-list');
            
            if (!selectedHousingAssignment) {
                roomsDiv.innerHTML = '<p>Select a group-gender assignment to see matching rooms.</p>';
                return;
            }
            
            const { gender, groupId } = selectedHousingAssignment;
            const matchingRooms = appData.housingRooms.filter(room => room.gender === gender);
            const assignedRooms = appData.housingAssignments[gender][groupId] || [];
            
            if (matchingRooms.length === 0) {
                roomsDiv.innerHTML = `<div class="notification error">⚠️ No ${gender} housing rooms available!</div>`;
                return;
            }
            
            let roomsHTML = '';
            matchingRooms.forEach(room => {
                const roomKey = `${room.building}-${room.roomId}`;
                const occupiedCount = getHousingRoomOccupancy(roomKey);
                const availableSpace = room.capacity - occupiedCount;
                const isAssigned = assignedRooms.includes(roomKey);
                
                roomsHTML += `
                    <div class="room-card ${isAssigned ? 'selected' : ''}" 
                         onclick="toggleHousingRoomSelection('${roomKey}')" style="cursor: pointer;">
                        <strong>${room.building} - ${room.roomId}</strong>
                        <p><strong>Capacity:</strong> ${room.capacity} | <strong>Available:</strong> ${availableSpace}</p>
                        ${room.accessibility ? `<p>♿ ${room.accessibility}</p>` : ''}
                        ${getHousingRoomAssignedGroupsDisplay(roomKey)}
                    </div>
                `;
            });
            
            roomsDiv.innerHTML = roomsHTML;
        }

        function toggleHousingRoomSelection(roomKey) {
            if (!selectedHousingAssignment) return;
            
            const { groupId, gender } = selectedHousingAssignment;
            
            if (!appData.housingAssignments[gender][groupId]) {
                appData.housingAssignments[gender][groupId] = [];
            }
            
            const assignedRooms = appData.housingAssignments[gender][groupId];
            const index = assignedRooms.indexOf(roomKey);
            
            if (index > -1) {
                assignedRooms.splice(index, 1);
                if (assignedRooms.length === 0) {
                    delete appData.housingAssignments[gender][groupId];
                }
            } else {
                assignedRooms.push(roomKey);
            }
            
            updateHousingAssignmentDisplay();
        }

        function updateHousingAssignmentActions() {
            const actionsDiv = document.getElementById('housing-assignment-actions');
            if (selectedHousingAssignment) {
                actionsDiv.style.display = 'block';
            } else {
                actionsDiv.style.display = 'none';
            }
        }

        function confirmHousingAssignment() {
            if (!selectedHousingAssignment) return;
            
            alert(`Housing assignment updated for ${selectedHousingAssignment.groupData.parish} (${selectedHousingAssignment.gender})`);
            updateAllDisplays();
            autoSave();
        }

        function clearHousingAssignment() {
            if (!selectedHousingAssignment) return;
            
            const { groupId, gender, groupData } = selectedHousingAssignment;
            
            if (confirm(`Clear all ${gender} housing assignments for ${groupData.parish}?`)) {
                delete appData.housingAssignments[gender][groupId];
                updateHousingAssignmentDisplay();
                updateAllDisplays();
                autoSave();
            }
        }

        function cancelHousingSelection() {
            selectedHousingAssignment = null;
            document.getElementById('housing-assignment-group-select').value = '';
            updateHousingAssignmentDisplay();
        }

        function filterHousingAssignmentDropdown() {
            const searchTerm = document.getElementById('housing-assignment-search').value.toLowerCase();
            const select = document.getElementById('housing-assignment-group-select');
            
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }
            
            appData.youthGroups.forEach(group => {
                const matchesSearch = !searchTerm || 
                    group.parish.toLowerCase().includes(searchTerm) ||
                    group.id.toLowerCase().includes(searchTerm) ||
                    group.leader.toLowerCase().includes(searchTerm);
                
                if (matchesSearch) {
                    const maleTotal = group.maleTeens + group.maleChaperones;
                    const femaleTotal = group.femaleTeens + group.femaleChaperones;
                    
                    if (maleTotal > 0) {
                        const option = document.createElement('option');
                        option.value = `${group.id}-male`;
                        option.textContent = `${group.id} - ${group.parish} - Males (${maleTotal} people)`;
                        select.appendChild(option);
                    }
                    
                    if (femaleTotal > 0) {
                        const option = document.createElement('option');
                        option.value = `${group.id}-female`;
                        option.textContent = `${group.id} - ${group.parish} - Females (${femaleTotal} people)`;
                        select.appendChild(option);
                    }
                }
            });
        }

        // ===== SMALL GROUP ASSIGNMENT MANAGEMENT =====
        function updateSmallGroupAssignmentDropdown() {
            document.getElementById('sg-assignment-search').value = '';
            const select = document.getElementById('sg-assignment-group-select');
            select.innerHTML = '<option value="">Select a Group for Small Group Assignment</option>';
            
            appData.youthGroups.forEach(group => {
                const totalGroup = group.maleTeens + group.femaleTeens + group.maleChaperones + group.femaleChaperones;
                
                if (totalGroup > 0) {
                    const option = document.createElement('option');
                    option.value = group.id;
                    option.textContent = `${group.id} - ${group.parish} (${totalGroup} people total)`;
                    select.appendChild(option);
                }
            });
        }

        function selectGroupForSmallGroupAssignment() {
            const select = document.getElementById('sg-assignment-group-select');
            const groupId = select.value;
            
            if (!groupId) {
                selectedSmallGroupAssignment = null;
                updateSmallGroupAssignmentDisplay();
                return;
            }
            
            const group = appData.youthGroups.find(g => g.id === groupId);
            
            selectedSmallGroupAssignment = {
                groupId: groupId,
                groupData: group
            };
            
            updateSmallGroupAssignmentDisplay();
        }

        function updateSmallGroupAssignmentDisplay() {
            updateSelectedSmallGroupInfo();
            updateAvailableSmallGroupRoomsList();
            updateSmallGroupAssignmentActions();
        }

        function updateSelectedSmallGroupInfo() {
            const infoDiv = document.getElementById('sg-selected-group-info');
            
            if (!selectedSmallGroupAssignment) {
                infoDiv.innerHTML = '<p>Please select a group above to see small group location options.</p>';
                return;
            }
            
            const { groupId, groupData } = selectedSmallGroupAssignment;
            const maleTotal = groupData.maleTeens + groupData.maleChaperones;
            const femaleTotal = groupData.femaleTeens + groupData.femaleChaperones;
            const totalPeople = maleTotal + femaleTotal;
                
            const assignedRooms = appData.smallGroupAssignments[groupId] || [];
            const roomNames = assignedRooms.map(roomKey => {
                const room = appData.smallGroupRooms.find(r => `${r.building}-${r.roomId}` === roomKey);
                return room ? `${room.building} - ${room.roomId}` : roomKey;
            });
            
            infoDiv.innerHTML = `
                <h4>${groupData.parish} (${groupId})</h4>
                <p><strong>Leader:</strong> ${groupData.leader}</p>
                <p><strong>Phone:</strong> ${groupData.phone}</p>
                <p><strong>Total Group:</strong> ${totalPeople} people</p>
                <p>(${maleTotal} males + ${femaleTotal} females)</p>
                ${groupData.specialAccommodations ? `<p><strong>Special Accommodations:</strong> ${groupData.specialAccommodations}</p>` : ''}
                
                ${assignedRooms.length > 0 ? `
                    <div class="male-section">
                        <strong>Current Small Group Location:</strong>
                        <p>${roomNames.join(', ')}</p>
                    </div>
                ` : `<p style="color: #e67e22;"><strong>⚠️ No small group location assigned yet.</strong></p>`}
            `;
        }

        function updateAvailableSmallGroupRoomsList() {
            const roomsDiv = document.getElementById('sg-available-rooms-list');
            
            if (!selectedSmallGroupAssignment) {
                roomsDiv.innerHTML = '<p>Select a group to see available small group locations.</p>';
                return;
            }
            
            const { groupId } = selectedSmallGroupAssignment;
            const assignedRooms = appData.smallGroupAssignments[groupId] || [];
            
            if (appData.smallGroupRooms.length === 0) {
                roomsDiv.innerHTML = `<div class="notification error">⚠️ No small group rooms available!</div>`;
                return;
            }
            
            let roomsHTML = '';
            appData.smallGroupRooms.forEach(room => {
                const roomKey = `${room.building}-${room.roomId}`;
                const occupiedCount = getSmallGroupRoomOccupancy(roomKey);
                const availableSpace = room.capacity - occupiedCount;
                const isAssigned = assignedRooms.includes(roomKey);
                
                roomsHTML += `
                    <div class="room-card ${isAssigned ? 'selected' : ''}" 
                         onclick="toggleSmallGroupRoomSelection('${roomKey}')" style="cursor: pointer;">
                        <strong>${room.building} - ${room.roomId}</strong>
                        <p><strong>Type:</strong> ${room.gender === 'mixed' ? 'Co-ed/Mixed' : room.gender.charAt(0).toUpperCase() + room.gender.slice(1)} | <strong>Capacity:</strong> ${room.capacity} | <strong>Available:</strong> ${availableSpace}</p>
                        ${room.features ? `<p>🏗️ ${room.features}</p>` : ''}
                        ${getSmallGroupRoomAssignedGroupsDisplay(roomKey)}
                    </div>
                `;
            });
            
            roomsDiv.innerHTML = roomsHTML;
        }

        function toggleSmallGroupRoomSelection(roomKey) {
            if (!selectedSmallGroupAssignment) return;
            
            const { groupId } = selectedSmallGroupAssignment;
            
            if (!appData.smallGroupAssignments[groupId]) {
                appData.smallGroupAssignments[groupId] = [];
            }
            
            const assignedRooms = appData.smallGroupAssignments[groupId];
            const index = assignedRooms.indexOf(roomKey);
            
            if (index > -1) {
                assignedRooms.splice(index, 1);
                if (assignedRooms.length === 0) {
                    delete appData.smallGroupAssignments[groupId];
                }
            } else {
                assignedRooms.push(roomKey);
            }
            
            updateSmallGroupAssignmentDisplay();
        }

        function updateSmallGroupAssignmentActions() {
            const actionsDiv = document.getElementById('sg-assignment-actions');
            if (selectedSmallGroupAssignment) {
                actionsDiv.style.display = 'block';
            } else {
                actionsDiv.style.display = 'none';
            }
        }

        function confirmSmallGroupAssignment() {
            if (!selectedSmallGroupAssignment) return;
            
            alert(`Small group assignment updated for ${selectedSmallGroupAssignment.groupData.parish}`);
            updateAllDisplays();
            autoSave();
        }

        function clearSmallGroupAssignment() {
            if (!selectedSmallGroupAssignment) return;
            
            const { groupId, groupData } = selectedSmallGroupAssignment;
            
            if (confirm(`Clear all small group location assignments for ${groupData.parish}?`)) {
                delete appData.smallGroupAssignments[groupId];
                updateSmallGroupAssignmentDisplay();
                updateAllDisplays();
                autoSave();
            }
        }

        function cancelSmallGroupSelection() {
            selectedSmallGroupAssignment = null;
            document.getElementById('sg-assignment-group-select').value = '';
            updateSmallGroupAssignmentDisplay();
        }

        function filterSmallGroupAssignmentDropdown() {
            const searchTerm = document.getElementById('sg-assignment-search').value.toLowerCase();
            const select = document.getElementById('sg-assignment-group-select');
            
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }
            
            appData.youthGroups.forEach(group => {
                const matchesSearch = !searchTerm || 
                    group.parish.toLowerCase().includes(searchTerm) ||
                    group.id.toLowerCase().includes(searchTerm) ||
                    group.leader.toLowerCase().includes(searchTerm);
                
                if (matchesSearch) {
                    const totalGroup = group.maleTeens + group.femaleTeens + group.maleChaperones + group.femaleChaperones;
                    
                    if (totalGroup > 0) {
                        const option = document.createElement('option');
                        option.value = group.id;
                        option.textContent = `${group.id} - ${group.parish} (${totalGroup} people total)`;
                        select.appendChild(option);
                    }
                }
            });
        }

        // ===== MEAL COLOR ASSIGNMENT MANAGEMENT =====
        function updateMealColorAssignment(groupId, color) {
            if (color === '') {
                delete appData.mealColorAssignments[groupId];
            } else {
                appData.mealColorAssignments[groupId] = color;
            }
            updateMealColorSummary();
            updateDashboard();
            autoSave();
        }

        function updateMealColorsTable() {
            const tbody = document.getElementById('meal-colors-table');
            tbody.innerHTML = '';

            const sortedGroups = getSortedMealColorGroups();
            
            sortedGroups.forEach(group => {
                const total = group.maleTeens + group.femaleTeens + group.maleChaperones + group.femaleChaperones;
                const assignedColor = appData.mealColorAssignments[group.id] || '';
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><span class="section-id">${group.id}</span></td>
                    <td>${group.parish}</td>
                    <td>${group.leader}</td>
                    <td><strong>${total}</strong></td>
                    <td>
                        <select onchange="updateMealColorAssignment('${group.id}', this.value)" style="padding: 5px; border-radius: 4px; border: 1px solid #bdc3c7;">
                            <option value="">Select Color</option>
                            ${MEAL_COLORS.map(color => 
                                `<option value="${color}" ${assignedColor === color ? 'selected' : ''}>${color}</option>`
                            ).join('')}
                        </select>
                        ${assignedColor ? `<span style="margin-left: 10px; padding: 2px 8px; border-radius: 4px; background: ${getColorForMealAssignment(assignedColor)}; color: white; font-size: 12px;">${assignedColor}</span>` : ''}
                    </td>
                    <td>
                        <button class="btn btn-warning" onclick="clearMealColor('${group.id}')" style="font-size: 12px; padding: 4px 8px;">Clear</button>
                    </td>
                `;
            });
        }

        function updateMealColorSummary() {
            // Initialize counts
            const colorCounts = {};
            MEAL_COLORS.forEach(color => {
                colorCounts[color] = 0;
            });
            
            // Count people per color
            Object.keys(appData.mealColorAssignments).forEach(groupId => {
                const color = appData.mealColorAssignments[groupId];
                const group = appData.youthGroups.find(g => g.id === groupId);
                if (group && color) {
                    const totalPeople = group.maleTeens + group.femaleTeens + group.maleChaperones + group.femaleChaperones;
                    colorCounts[color] += totalPeople;
                }
            });
            
            // Update display
            MEAL_COLORS.forEach(color => {
                const element = document.getElementById(`${color.toLowerCase()}-meal-count`);
                if (element) {
                    element.textContent = colorCounts[color];
                }
            });
        }

        function getColorForMealAssignment(colorName) {
            const colorMap = {
                'Blue': '#3498db',
                'Red': '#e74c3c',
                'Orange': '#e67e22',
                'Yellow': '#f1c40f',
                'Green': '#27ae60',
                'Purple': '#9b59b6',
                'Brown': '#8b4513',
                'Grey': '#95a5a6'
            };
            return colorMap[colorName] || '#bdc3c7';
        }

        function clearMealColor(groupId) {
            if (confirm('Clear meal color assignment for this group?')) {
                delete appData.mealColorAssignments[groupId];
                updateMealColorsTable();
                updateMealColorSummary();
                updateDashboard();
                autoSave();
            }
        }

        function confirmMealColorAssignments() {
            alert('Meal color assignments updated successfully!');
            updateAllDisplays();
            autoSave();
        }
        function getHousingRoomOccupancy(roomKey) {
            let total = 0;
            
            Object.keys(appData.housingAssignments.male).forEach(groupId => {
                const assignments = appData.housingAssignments.male[groupId];
                if (Array.isArray(assignments) && assignments.includes(roomKey)) {
                    const group = appData.youthGroups.find(g => g.id === groupId);
                    if (group) {
                        total += group.maleTeens + group.maleChaperones;
                    }
                }
            });
            
            Object.keys(appData.housingAssignments.female).forEach(groupId => {
                const assignments = appData.housingAssignments.female[groupId];
                if (Array.isArray(assignments) && assignments.includes(roomKey)) {
                    const group = appData.youthGroups.find(g => g.id === groupId);
                    if (group) {
                        total += group.femaleTeens + group.femaleChaperones;
                    }
                }
            });
            
            return total;
        }

        function getSmallGroupRoomOccupancy(roomKey) {
            let total = 0;
            
            Object.keys(appData.smallGroupAssignments).forEach(groupId => {
                const assignments = appData.smallGroupAssignments[groupId];
                if (Array.isArray(assignments) && assignments.includes(roomKey)) {
                    const group = appData.youthGroups.find(g => g.id === groupId);
                    if (group) {
                        total += group.maleTeens + group.femaleTeens + group.maleChaperones + group.femaleChaperones;
                    }
                }
            });
            
            return total;
        }

        function getHousingRoomAssignedGroupsDisplay(roomKey) {
            const assignedGroups = [];
            
            Object.keys(appData.housingAssignments.male).forEach(groupId => {
                const assignments = appData.housingAssignments.male[groupId];
                if (Array.isArray(assignments) && assignments.includes(roomKey)) {
                    assignedGroups.push(`${groupId}(M)`);
                }
            });
            
            Object.keys(appData.housingAssignments.female).forEach(groupId => {
                const assignments = appData.housingAssignments.female[groupId];
                if (Array.isArray(assignments) && assignments.includes(roomKey)) {
                    assignedGroups.push(`${groupId}(F)`);
                }
            });
            
            return assignedGroups.length > 0 ? 
                `<p><strong>Assigned:</strong> ${assignedGroups.join(', ')}</p>` : '';
        }

        function getSmallGroupRoomAssignedGroupsDisplay(roomKey) {
            const assignedGroups = [];
            
            Object.keys(appData.smallGroupAssignments).forEach(groupId => {
                const assignments = appData.smallGroupAssignments[groupId];
                if (Array.isArray(assignments) && assignments.includes(roomKey)) {
                    assignedGroups.push(groupId);
                }
            });
            
            return assignedGroups.length > 0 ? 
                `<p><strong>Assigned:</strong> ${assignedGroups.join(', ')}</p>` : '';
        }

        function isGroupHousingAssigned(groupId) {
            const maleAssignments = appData.housingAssignments.male[groupId];
            const femaleAssignments = appData.housingAssignments.female[groupId];
            return (Array.isArray(maleAssignments) && maleAssignments.length > 0) ||
                   (Array.isArray(femaleAssignments) && femaleAssignments.length > 0);
        }

        function isGroupSmallGroupAssigned(groupId) {
            const assignments = appData.smallGroupAssignments[groupId];
            return Array.isArray(assignments) && assignments.length > 0;
        }

        // ===== DISPLAY UPDATE FUNCTIONS =====
        function updateAllDisplays() {
            updateYouthGroupsTable();
            updateHousingRoomsTable();
            updateSmallGroupRoomsTable();
            updateMealColorsTable();
            updateMealColorSummary();
            updateDashboard();
            updateAssignmentOverview();
        }

        function updateYouthGroupsTable() {
            const tbody = document.getElementById('youth-groups-table');
            tbody.innerHTML = '';

            const sortedGroups = getSortedYouthGroups();
            
            sortedGroups.forEach((group, sortedIndex) => {
                const originalIndex = appData.youthGroups.indexOf(group);
                const total = group.maleTeens + group.femaleTeens + group.maleChaperones + group.femaleChaperones;
                const isAssigned = isGroupHousingAssigned(group.id);
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><span class="section-id">${group.id}</span></td>
                    <td>${group.parish}</td>
                    <td>${group.leader}</td>
                    <td>${group.seminarianSgl || 'Not Assigned'}</td>
                    <td>${group.phone}</td>
                    <td>${group.maleTeens}</td>
                    <td>${group.femaleTeens}</td>
                    <td>${group.maleChaperones}</td>
                    <td>${group.femaleChaperones}</td>
                    <td><strong>${total}</strong></td>
                    <td style="font-size: 12px; max-width: 150px; word-wrap: break-word;">${group.specialAccommodations || 'None'}</td>
                    <td><span class="assignment-status ${isAssigned ? 'status-assigned' : 'status-unassigned'}">${isAssigned ? '✅ Assigned' : '❌ Unassigned'}</span></td>
                    <td>
                        <button class="btn btn-warning" onclick="editYouthGroup(${originalIndex})" style="font-size: 12px; padding: 6px 12px;">Edit</button>
                    </td>
                `;
            });
        }

        function updateHousingRoomsTable() {
            const tbody = document.getElementById('housing-rooms-table');
            tbody.innerHTML = '';

            const sortedRooms = getSortedHousingRooms();

            sortedRooms.forEach((room, sortedIndex) => {
                const originalIndex = appData.housingRooms.indexOf(room);
                const roomKey = `${room.building}-${room.roomId}`;
                const occupiedCount = getHousingRoomOccupancy(roomKey);
                const availableSpace = room.capacity - occupiedCount;
                const assignedGroups = getHousingRoomAssignedGroupsDisplay(roomKey);
                
                const row = tbody.insertRow();
                const sectionId = `${room.building.substring(0, 3).toUpperCase()}-${room.roomId}`;
                
                row.innerHTML = `
                    <td><span class="section-id">${sectionId}</span></td>
                    <td>${room.building}</td>
                    <td>${room.roomId}</td>
                    <td>${room.gender.charAt(0).toUpperCase() + room.gender.slice(1)}</td>
                    <td>${room.capacity}</td>
                    <td>${occupiedCount}</td>
                    <td class="capacity-display ${availableSpace < 0 ? 'capacity-negative' : availableSpace === 0 ? 'capacity-zero' : 'capacity-positive'}">${availableSpace}</td>
                    <td>${room.accessibility ? '♿' : '✅'}</td>
                    <td style="font-size: 12px;">${assignedGroups.replace(/<[^>]*>/g, '').replace('Assigned: ', '') || 'None'}</td>
                    <td>
                        <button class="btn btn-warning" onclick="editHousingRoom(${originalIndex})" style="font-size: 12px; padding: 6px 12px;">Edit</button>
                    </td>
                `;
            });
        }

        function updateSmallGroupRoomsTable() {
            const tbody = document.getElementById('small-group-rooms-table');
            tbody.innerHTML = '';

            const sortedRooms = getSortedSmallGroupRooms();

            sortedRooms.forEach((room, sortedIndex) => {
                const originalIndex = appData.smallGroupRooms.indexOf(room);
                const roomKey = `${room.building}-${room.roomId}`;
                const occupiedCount = getSmallGroupRoomOccupancy(roomKey);
                const availableSpace = room.capacity - occupiedCount;
                const assignedGroups = getSmallGroupRoomAssignedGroupsDisplay(roomKey);
                
                const row = tbody.insertRow();
                const locationId = `${room.building.substring(0, 3).toUpperCase()}-${room.roomId}`;
                
                row.innerHTML = `
                    <td><span class="section-id">${locationId}</span></td>
                    <td>${room.building}</td>
                    <td>${room.roomId}</td>
                    <td>${room.gender === 'mixed' ? 'Mixed/Co-ed' : room.gender.charAt(0).toUpperCase() + room.gender.slice(1)}</td>
                    <td>${room.capacity}</td>
                    <td>${occupiedCount}</td>
                    <td class="capacity-display ${availableSpace < 0 ? 'capacity-negative' : availableSpace === 0 ? 'capacity-zero' : 'capacity-positive'}">${availableSpace}</td>
                    <td>${room.features ? '🏗️' : '✅'}</td>
                    <td style="font-size: 12px;">${assignedGroups.replace(/<[^>]*>/g, '').replace('Assigned: ', '') || 'None'}</td>
                    <td>
                        <button class="btn btn-warning" onclick="editSmallGroupRoom(${originalIndex})" style="font-size: 12px; padding: 6px 12px;">Edit</button>
                    </td>
                `;
            });
        }

        function updateDashboard() {
            // Basic counts
            const totalGroups = appData.youthGroups.length;
            const totalParticipants = appData.youthGroups.reduce((total, group) => 
                total + group.maleTeens + group.femaleTeens + group.maleChaperones + group.femaleChaperones, 0);
            
            // Housing analysis
            const groupsNeedingHousing = appData.youthGroups.filter(g => !isGroupHousingAssigned(g.id)).length;
            const groupsNeedingSmallGroup = appData.youthGroups.filter(g => !isGroupSmallGroupAssigned(g.id)).length;
            const groupsNeedingMealColor = appData.youthGroups.filter(g => !appData.mealColorAssignments[g.id]).length;
            
            // Male housing capacity analysis (excluding Off Campus)
            const maleHousingRooms = appData.housingRooms.filter(room => room.gender === 'male' && room.building !== 'Off Campus');
            const totalMaleHousingCapacity = maleHousingRooms.reduce((total, room) => total + room.capacity, 0);
            const usedMaleHousingCapacity = maleHousingRooms.reduce((total, room) => {
                return total + getHousingRoomOccupancy(`${room.building}-${room.roomId}`);
            }, 0);
            const maleHousingUtilization = totalMaleHousingCapacity > 0 ? Math.round((usedMaleHousingCapacity / totalMaleHousingCapacity) * 100) : 0;
            
            // Female housing capacity analysis (excluding Off Campus)
            const femaleHousingRooms = appData.housingRooms.filter(room => room.gender === 'female' && room.building !== 'Off Campus');
            const totalFemaleHousingCapacity = femaleHousingRooms.reduce((total, room) => total + room.capacity, 0);
            const usedFemaleHousingCapacity = femaleHousingRooms.reduce((total, room) => {
                return total + getHousingRoomOccupancy(`${room.building}-${room.roomId}`);
            }, 0);
            const femaleHousingUtilization = totalFemaleHousingCapacity > 0 ? Math.round((usedFemaleHousingCapacity / totalFemaleHousingCapacity) * 100) : 0;
            
            // Mixed/Co-ed small group room capacity analysis
            const mixedSmallGroupRooms = appData.smallGroupRooms.filter(room => room.gender === 'mixed');
            const totalMixedSGCapacity = mixedSmallGroupRooms.reduce((total, room) => total + room.capacity, 0);
            const usedMixedSGCapacity = mixedSmallGroupRooms.reduce((total, room) => {
                return total + getSmallGroupRoomOccupancy(`${room.building}-${room.roomId}`);
            }, 0);
            const mixedSGUtilization = totalMixedSGCapacity > 0 ? Math.round((usedMixedSGCapacity / totalMixedSGCapacity) * 100) : 0;
            
            // Available rooms analysis
            const availableHousingRooms = appData.housingRooms.filter(room => {
                const occupancy = getHousingRoomOccupancy(`${room.building}-${room.roomId}`);
                return occupancy < room.capacity;
            }).length;
            
            const availableSmallGroupRooms = appData.smallGroupRooms.filter(room => {
                const occupancy = getSmallGroupRoomOccupancy(`${room.building}-${room.roomId}`);
                return occupancy < room.capacity;
            }).length;
            
            // Update the display
            document.getElementById('total-groups').textContent = totalGroups;
            document.getElementById('total-participants').textContent = totalParticipants;
            document.getElementById('groups-needing-housing').textContent = groupsNeedingHousing;
            document.getElementById('groups-needing-small-group').textContent = groupsNeedingSmallGroup;
            document.getElementById('groups-needing-meal-color').textContent = groupsNeedingMealColor;
            
            // Male housing stats
            document.getElementById('male-housing-capacity').textContent = totalMaleHousingCapacity;
            document.getElementById('male-housing-used').textContent = usedMaleHousingCapacity;
            document.getElementById('male-housing-utilization').textContent = maleHousingUtilization + '%';
            
            // Female housing stats
            document.getElementById('female-housing-capacity').textContent = totalFemaleHousingCapacity;
            document.getElementById('female-housing-used').textContent = usedFemaleHousingCapacity;
            document.getElementById('female-housing-utilization').textContent = femaleHousingUtilization + '%';
            
            // Mixed small group stats
            document.getElementById('mixed-sg-capacity').textContent = totalMixedSGCapacity;
            document.getElementById('mixed-sg-used').textContent = usedMixedSGCapacity;
            document.getElementById('mixed-sg-utilization').textContent = mixedSGUtilization + '%';
            
            // General stats
            document.getElementById('available-housing-rooms').textContent = availableHousingRooms;
            document.getElementById('available-small-group-rooms').textContent = availableSmallGroupRooms;
        }

        function updateAssignmentOverview() {
            const overviewDiv = document.getElementById('assignment-overview');
            
            if (appData.youthGroups.length === 0) {
                overviewDiv.innerHTML = '<p>No youth groups added yet.</p>';
                return;
            }
            
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 15px;">';
            
            appData.youthGroups.forEach(group => {
                const isHousingAssigned = isGroupHousingAssigned(group.id);
                const isSmallGroupAssigned = isGroupSmallGroupAssigned(group.id);
                const mealColor = appData.mealColorAssignments[group.id] || '';
                const maleTotal = group.maleTeens + group.maleChaperones;
                const femaleTotal = group.femaleTeens + group.femaleChaperones;
                const totalGroup = maleTotal + femaleTotal;
                
                // Get housing assignments
                const maleHousingRooms = appData.housingAssignments.male[group.id] || [];
                const femaleHousingRooms = appData.housingAssignments.female[group.id] || [];
                
                const maleHousingRoomNames = maleHousingRooms.map(roomKey => {
                    const room = appData.housingRooms.find(r => `${r.building}-${r.roomId}` === roomKey);
                    return room ? `${room.building}-${room.roomId}` : roomKey;
                });
                
                const femaleHousingRoomNames = femaleHousingRooms.map(roomKey => {
                    const room = appData.housingRooms.find(r => `${r.building}-${r.roomId}` === roomKey);
                    return room ? `${room.building}-${room.roomId}` : roomKey;
                });
                
                // Get small group assignments
                const groupSmallGroupRooms = appData.smallGroupAssignments[group.id] || [];
                
                const groupSmallGroupRoomNames = groupSmallGroupRooms.map(roomKey => {
                    const room = appData.smallGroupRooms.find(r => `${r.building}-${r.roomId}` === roomKey);
                    return room ? `${room.building}-${room.roomId}` : roomKey;
                });
                
                const overallAssigned = isHousingAssigned || isSmallGroupAssigned;
                
                html += `
                    <div class="room-card" style="border-left-color: ${overallAssigned ? '#27ae60' : '#e74c3c'};">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <strong>${group.parish}</strong>
                            <div style="display: flex; gap: 5px; align-items: center;">
                                <span class="assignment-status ${isHousingAssigned ? 'status-assigned' : 'status-unassigned'}" style="font-size: 10px;">
                                    🏠 ${isHousingAssigned ? '✅' : '❌'}
                                </span>
                                <span class="assignment-status ${isSmallGroupAssigned ? 'status-assigned' : 'status-unassigned'}" style="font-size: 10px;">
                                    👥 ${isSmallGroupAssigned ? '✅' : '❌'}
                                </span>
                                ${mealColor ? `<span style="padding: 2px 6px; border-radius: 4px; background: ${getColorForMealAssignment(mealColor)}; color: white; font-size: 10px; font-weight: bold;">🍽️ ${mealColor}</span>` : '<span style="font-size: 10px; color: #e67e22;">🍽️ No Color</span>'}
                            </div>
                        </div>
                        <p><span class="section-id">${group.id}</span> | ${totalGroup} people total</p>
                        ${group.seminarianSgl ? `<p style="font-size: 12px; color: #2c3e50;"><strong>Seminarian SGL:</strong> ${group.seminarianSgl}</p>` : ''}
                        
                        <!-- Housing Assignments -->
                        <div style="background: #f8f9fa; padding: 8px; border-radius: 6px; margin: 8px 0;">
                            <strong style="font-size: 14px;">🏠 Housing Assignments</strong>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 5px;">
                                ${maleTotal > 0 ? `
                                    <div class="male-section" style="padding: 6px;">
                                        <strong style="font-size: 12px;">🔵 Males: ${maleTotal}</strong>
                                        ${maleHousingRoomNames.length > 0 ? `<p style="font-size: 10px; margin: 2px 0 0 0;">${maleHousingRoomNames.join(', ')}</p>` : '<p style="font-size: 10px; color: #e67e22; margin: 2px 0 0 0;">Not assigned</p>'}
                                    </div>
                                ` : '<div></div>'}
                                
                                ${femaleTotal > 0 ? `
                                    <div class="female-section" style="padding: 6px;">
                                        <strong style="font-size: 12px;">🟣 Females: ${femaleTotal}</strong>
                                        ${femaleHousingRoomNames.length > 0 ? `<p style="font-size: 10px; margin: 2px 0 0 0;">${femaleHousingRoomNames.join(', ')}</p>` : '<p style="font-size: 10px; color: #e67e22; margin: 2px 0 0 0;">Not assigned</p>'}
                                    </div>
                                ` : '<div></div>'}
                            </div>
                        </div>
                        
                        <!-- Small Group Assignments -->
                        <div style="background: #f0f8ff; padding: 8px; border-radius: 6px; margin: 8px 0;">
                            <strong style="font-size: 14px;">👥 Small Group Location</strong>
                            ${groupSmallGroupRoomNames.length > 0 ? `
                                <div style="background: linear-gradient(45deg, #e8f4f8, #fdf2f2); padding: 6px; border-radius: 4px; margin-top: 5px;">
                                    <strong style="font-size: 12px;">🟡 Group Location:</strong>
                                    <p style="font-size: 10px; margin: 2px 0 0 0;">${groupSmallGroupRoomNames.join(', ')}</p>
                                </div>
                            ` : `<div style="background: #fff3cd; padding: 4px; border-radius: 4px; margin-top: 5px; text-align: center;">
                                <p style="font-size: 10px; color: #856404; margin: 0;">No small group location assigned</p>
                            </div>`}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            overviewDiv.innerHTML = html;
        }

        // ===== SEARCH FUNCTIONALITY =====
        function performSearch() {
            const searchTerm = document.getElementById('parish-search').value.toLowerCase();
            const resultsDiv = document.getElementById('search-results');
            
            if (!searchTerm.trim()) {
                resultsDiv.innerHTML = '';
                return;
            }
            
            const matchingGroups = appData.youthGroups.filter(group => 
                group.parish.toLowerCase().includes(searchTerm) ||
                group.id.toLowerCase().includes(searchTerm) ||
                group.leader.toLowerCase().includes(searchTerm) ||
                (group.seminarianSgl && group.seminarianSgl.toLowerCase().includes(searchTerm)) ||
                group.phone.toLowerCase().includes(searchTerm)
            );
            
            if (matchingGroups.length === 0) {
                resultsDiv.innerHTML = '<div class="notification warning">No groups found matching your search.</div>';
                return;
            }
            
            let html = '<h3>Search Results</h3><div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 15px;">';
            
            matchingGroups.forEach(group => {
                const isHousingAssigned = isGroupHousingAssigned(group.id);
                const isSmallGroupAssigned = isGroupSmallGroupAssigned(group.id);
                const mealColor = appData.mealColorAssignments[group.id] || '';
                const maleTotal = group.maleTeens + group.maleChaperones;
                const femaleTotal = group.femaleTeens + group.femaleChaperones;
                const totalGroup = maleTotal + femaleTotal;
                
                // Get housing assignments
                const maleHousingRooms = appData.housingAssignments.male[group.id] || [];
                const femaleHousingRooms = appData.housingAssignments.female[group.id] || [];
                
                const maleHousingRoomNames = maleHousingRooms.map(roomKey => {
                    const room = appData.housingRooms.find(r => `${r.building}-${r.roomId}` === roomKey);
                    return room ? `${room.building}-${room.roomId}` : roomKey;
                });
                
                const femaleHousingRoomNames = femaleHousingRooms.map(roomKey => {
                    const room = appData.housingRooms.find(r => `${r.building}-${r.roomId}` === roomKey);
                    return room ? `${room.building}-${room.roomId}` : roomKey;
                });
                
                // Get small group assignments
                const groupSmallGroupRooms = appData.smallGroupAssignments[group.id] || [];
                
                const groupSmallGroupRoomNames = groupSmallGroupRooms.map(roomKey => {
                    const room = appData.smallGroupRooms.find(r => `${r.building}-${r.roomId}` === roomKey);
                    return room ? `${room.building}-${room.roomId}` : roomKey;
                });
                
                const overallAssigned = isHousingAssigned || isSmallGroupAssigned;
                
                html += `
                    <div class="room-card" style="border-left-color: ${overallAssigned ? '#27ae60' : '#e74c3c'};">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <strong>${group.parish}</strong>
                            <div style="display: flex; gap: 5px;">
                                <span class="assignment-status ${isHousingAssigned ? 'status-assigned' : 'status-unassigned'}" style="font-size: 10px;">
                                    🏠 ${isHousingAssigned ? '✅' : '❌'}
                                </span>
                                <span class="assignment-status ${isSmallGroupAssigned ? 'status-assigned' : 'status-unassigned'}" style="font-size: 10px;">
                                    👥 ${isSmallGroupAssigned ? '✅' : '❌'}
                                </span>
                            </div>
                        </div>
                        <p><span class="section-id">${group.id}</span> | <strong>Leader:</strong> ${group.leader} | <strong>Phone:</strong> ${group.phone}</p>
                        ${group.seminarianSgl ? `<p><strong>Seminarian SGL:</strong> ${group.seminarianSgl}</p>` : ''}
                        <p><strong>Total People:</strong> ${totalGroup} (${maleTotal} males, ${femaleTotal} females)</p>
                        ${group.specialAccommodations ? `<p style="margin-top: 8px; font-size: 12px;"><strong>Special Accommodations:</strong> ${group.specialAccommodations}</p>` : ''}
                        
                        <!-- Meal Color Display -->
                        ${mealColor ? `<div style="margin: 8px 0;"><strong>Meal Color:</strong> <span style="padding: 2px 6px; border-radius: 4px; background: ${getColorForMealAssignment(mealColor)}; color: white; font-size: 12px; font-weight: bold;">${mealColor}</span></div>` : '<div style="margin: 8px 0; color: #e67e22;"><strong>Meal Color:</strong> Not assigned</div>'}
                        
                        <!-- Housing Assignments -->
                        <div style="background: #f8f9fa; padding: 8px; border-radius: 6px; margin: 8px 0;">
                            <strong style="font-size: 14px;">🏠 Housing Assignments</strong>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 5px;">
                                ${maleTotal > 0 ? `
                                    <div class="male-section" style="padding: 6px;">
                                        <strong style="font-size: 12px;">🔵 Males: ${maleTotal}</strong>
                                        ${maleHousingRoomNames.length > 0 ? `<p style="font-size: 10px; margin: 2px 0 0 0;">${maleHousingRoomNames.join(', ')}</p>` : '<p style="font-size: 10px; color: #e67e22; margin: 2px 0 0 0;">Not assigned</p>'}
                                    </div>
                                ` : '<div></div>'}
                                
                                ${femaleTotal > 0 ? `
                                    <div class="female-section" style="padding: 6px;">
                                        <strong style="font-size: 12px;">🟣 Females: ${femaleTotal}</strong>
                                        ${femaleHousingRoomNames.length > 0 ? `<p style="font-size: 10px; margin: 2px 0 0 0;">${femaleHousingRoomNames.join(', ')}</p>` : '<p style="font-size: 10px; color: #e67e22; margin: 2px 0 0 0;">Not assigned</p>'}
                                    </div>
                                ` : '<div></div>'}
                            </div>
                        </div>
                        
                        <!-- Small Group Assignments -->
                        <div style="background: #f0f8ff; padding: 8px; border-radius: 6px; margin: 8px 0;">
                            <strong style="font-size: 14px;">👥 Small Group Location</strong>
                            ${groupSmallGroupRoomNames.length > 0 ? `
                                <div style="background: linear-gradient(45deg, #e8f4f8, #fdf2f2); padding: 6px; border-radius: 4px; margin-top: 5px;">
                                    <strong style="font-size: 12px;">🟡 Group Location:</strong>
                                    <p style="font-size: 10px; margin: 2px 0 0 0;">${groupSmallGroupRoomNames.join(', ')}</p>
                                </div>
                            ` : `<div style="background: #fff3cd; padding: 4px; border-radius: 4px; margin-top: 5px; text-align: center;">
                                <p style="font-size: 10px; color: #856404; margin: 0;">No small group location assigned</p>
                            </div>`}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        }

        // ===== DATA MANAGEMENT =====
        function autoSave() {
            window.housingData = { ...appData, timestamp: new Date().toISOString() };
        }

        async function saveToGitHub(jsonData) {
            const { username, repo, branch, filename, token } = GITHUB_CONFIG;
            const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${filename}`;
            
            try {
                // First, get the current file to retrieve its SHA (required for updates)
                let sha = null;
                try {
                    const getResponse = await fetch(apiUrl, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (getResponse.ok) {
                        const fileData = await getResponse.json();
                        sha = fileData.sha;
                    }
                } catch (e) {
                    // File might not exist yet, which is fine
                }
                
                // Encode content to base64
                const content = btoa(unescape(encodeURIComponent(jsonData)));
                
                // Prepare the update payload
                const payload = {
                    message: `Update housing data - ${new Date().toLocaleString()}`,
                    content: content,
                    branch: branch
                };
                
                // Include SHA if file exists (for update)
                if (sha) {
                    payload.sha = sha;
                }
                
                // Upload to GitHub
                const response = await fetch(apiUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'GitHub upload failed');
                }
                
                return { success: true };
                
            } catch (error) {
                console.error('GitHub save error:', error);
                return { success: false, error: error.message };
            }
        }

        async function saveData() {
            const data = { ...appData, timestamp: new Date().toISOString(), version: '3.0' };
            const dataStr = JSON.stringify(data, null, 2);
            
            // Save to GitHub
            const result = await saveToGitHub(dataStr);
            
            if (result.success) {
                alert('✅ Data saved successfully to GitHub!\n\nFile: m2k_2026_housing_data (1).json\nYour read-only dashboard will now show the latest data.');
            } else {
                alert('❌ Error saving to GitHub: ' + result.error + '\n\nDownloading backup file instead...');
                
                // Fallback: download locally
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = 'm2k_2026_housing_data.json';
                link.click();
            }
        }

        function loadData() {
            document.getElementById('load-file').click();
        }

        function handleLoadFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.youthGroups && data.housingRooms && data.housingAssignments) {
                        if (confirm('This will replace all current data. Continue?')) {
                            appData.youthGroups = data.youthGroups;
                            appData.housingRooms = data.housingRooms;
                            appData.housingAssignments = data.housingAssignments;
                            appData.smallGroupRooms = data.smallGroupRooms || [];
                            appData.smallGroupAssignments = data.smallGroupAssignments || {};
                            appData.mealColorAssignments = data.mealColorAssignments || {};
                            
                            updateAllDisplays();
                            updateHousingAssignmentDropdown();
                            updateSmallGroupAssignmentDropdown();
                            
                            alert('Data loaded successfully!');
                        }
                    } else {
                        alert('Invalid file format.');
                    }
                } catch (error) {
                    alert('Error reading file: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function exportToCSV() {
            const headers = [
                'Group ID', 'Parish Name', 'Group Leader', 'Seminarian SGL', 'Phone Number',
                'Male Teens', 'Female Teens', 'Male Chaperones', 'Female Chaperones', 'Total People',
                'Special Accommodations', 'Meal Color', 'Male Housing Assignments', 'Female Housing Assignments', 
                'Small Group Assignments', 'Housing Assignment Status', 'Small Group Assignment Status'
            ];
            
            let csvContent = headers.join(',') + '\n';
            
            appData.youthGroups.forEach(group => {
                const totalPeople = group.maleTeens + group.femaleTeens + group.maleChaperones + group.femaleChaperones;
                
                // Get housing assignments
                const maleHousingRooms = appData.housingAssignments.male[group.id] || [];
                const femaleHousingRooms = appData.housingAssignments.female[group.id] || [];
                
                const maleHousingRoomNames = maleHousingRooms.map(roomKey => {
                    const room = appData.housingRooms.find(r => `${r.building}-${r.roomId}` === roomKey);
                    return room ? `${room.building} - ${room.roomId}` : roomKey;
                });
                
                const femaleHousingRoomNames = femaleHousingRooms.map(roomKey => {
                    const room = appData.housingRooms.find(r => `${r.building}-${r.roomId}` === roomKey);
                    return room ? `${room.building} - ${room.roomId}` : roomKey;
                });
                
                // Get small group assignments
                const groupSmallGroupRooms = appData.smallGroupAssignments[group.id] || [];
                
                const groupSmallGroupRoomNames = groupSmallGroupRooms.map(roomKey => {
                    const room = appData.smallGroupRooms.find(r => `${r.building}-${r.roomId}` === roomKey);
                    return room ? `${room.building} - ${room.roomId}` : roomKey;
                });
                
                const isHousingAssigned = maleHousingRooms.length > 0 || femaleHousingRooms.length > 0;
                const isSmallGroupAssigned = groupSmallGroupRooms.length > 0;
                const mealColor = appData.mealColorAssignments[group.id] || '';
                
                const row = [
                    group.id,
                    `"${group.parish}"`,
                    `"${group.leader}"`,
                    `"${group.seminarianSgl || ''}"`,
                    group.phone,
                    group.maleTeens,
                    group.femaleTeens,
                    group.maleChaperones,
                    group.femaleChaperones,
                    totalPeople,
                    `"${group.specialAccommodations || ''}"`,
                    mealColor,
                    `"${maleHousingRoomNames.join('; ')}"`,
                    `"${femaleHousingRoomNames.join('; ')}"`,
                    `"${groupSmallGroupRoomNames.join('; ')}"`,
                    isHousingAssigned ? 'Assigned' : 'Unassigned',
                    isSmallGroupAssigned ? 'Assigned' : 'Unassigned'
                ];
                csvContent += row.join(',') + '\n';
            });
            
            // Add housing room summary
            csvContent += '\n\nHOUSING ROOM ASSIGNMENTS SUMMARY\n';
            csvContent += 'Building,Room,Gender,Capacity,Occupied,Available,Assigned Groups\n';
            
            appData.housingRooms.forEach(room => {
                const roomKey = `${room.building}-${room.roomId}`;
                const occupiedCount = getHousingRoomOccupancy(roomKey);
                const assignedGroupsText = getHousingRoomAssignedGroupsDisplay(roomKey).replace(/<[^>]*>/g, '').replace('Assigned: ', '') || 'None';
                
                csvContent += `"${room.building}","${room.roomId}","${room.gender}",${room.capacity},${occupiedCount},${room.capacity - occupiedCount},"${assignedGroupsText}"\n`;
            });
            
            // Add small group room summary
            csvContent += '\n\nSMALL GROUP ROOM ASSIGNMENTS SUMMARY\n';
            csvContent += 'Building,Room,Gender,Capacity,Occupied,Available,Assigned Groups\n';
            
            appData.smallGroupRooms.forEach(room => {
                const roomKey = `${room.building}-${room.roomId}`;
                const occupiedCount = getSmallGroupRoomOccupancy(roomKey);
                const assignedGroupsText = getSmallGroupRoomAssignedGroupsDisplay(roomKey).replace(/<[^>]*>/g, '').replace('Assigned: ', '') || 'None';
                
                csvContent += `"${room.building}","${room.roomId}","${room.gender === 'mixed' ? 'Mixed/Co-ed' : room.gender}",${room.capacity},${occupiedCount},${room.capacity - occupiedCount},"${assignedGroupsText}"\n`;
            });
            
            // Add meal color summary
            csvContent += '\n\nMEAL COLOR ASSIGNMENTS SUMMARY\n';
            csvContent += 'Meal Color,Groups Assigned,Total People\n';
            
            const mealColorSummary = {};
            MEAL_COLORS.forEach(color => {
                mealColorSummary[color] = { groups: 0, people: 0 };
            });
            
            Object.keys(appData.mealColorAssignments).forEach(groupId => {
                const color = appData.mealColorAssignments[groupId];
                const group = appData.youthGroups.find(g => g.id === groupId);
                if (group && color && mealColorSummary[color]) {
                    mealColorSummary[color].groups++;
                    mealColorSummary[color].people += group.maleTeens + group.femaleTeens + group.maleChaperones + group.femaleChaperones;
                }
            });
            
            MEAL_COLORS.forEach(color => {
                csvContent += `${color},${mealColorSummary[color].groups},${mealColorSummary[color].people}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `mount2k_complete_assignments_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('Complete housing, small group, and meal color data exported successfully! The CSV includes separate sections for all assignments.');
        }

        function exportCompleteHTML() {
            // Get the current HTML content
            let htmlContent = document.documentElement.outerHTML;
            
            // Create the new loadSampleData function with current data
            const currentDataString = `
            appData.youthGroups = ${JSON.stringify(appData.youthGroups, null, 12)};

            appData.housingRooms = ${JSON.stringify(appData.housingRooms, null, 12)};

            appData.smallGroupRooms = ${JSON.stringify(appData.smallGroupRooms, null, 12)};

            appData.housingAssignments = ${JSON.stringify(appData.housingAssignments, null, 12)};
            appData.smallGroupAssignments = ${JSON.stringify(appData.smallGroupAssignments, null, 12)};`;

            // Find and replace the loadSampleData function content
            const loadSampleDataRegex = /function loadSampleData\(\) \{[\s\S]*?appData\.smallGroupAssignments = \{\};[\s\S]*?\}/;
            
            const newLoadSampleDataFunction = `function loadSampleData() {
            ${currentDataString}
        }`;

            // Replace the function in the HTML
            htmlContent = htmlContent.replace(loadSampleDataRegex, newLoadSampleDataFunction);
            
            // Add a comment at the top indicating this is a saved version
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            htmlContent = htmlContent.replace(
                '<title>Mount 2K Housing Management System</title>',
                `<title>Mount 2K Housing Management System - Saved ${new Date().toLocaleDateString()}</title>`
            );
            
            // Create and download the file
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `mount2k_housing_system_complete_${timestamp.split('T')[0]}.html`;
            link.click();
            
            alert('Complete HTML site exported! 🌐\n\nYou can now upload this HTML file to any web host and it will load with all your current assignments. The file includes:\n• All youth groups\n• All room assignments\n• All small group assignments\n\nJust upload the HTML file to your hosting service!');
        }

        // ===== SYSTEM INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', initializeSystem);
    </script>
</body>
</html>